/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 1);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/tail.select/js/tail.select.js":
/*!****************************************************!*\
  !*** ./node_modules/tail.select/js/tail.select.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_RESULT__;/*\r\n |  tail.select - The vanilla solution to make your HTML select fields AWESOME!\r\n |  @file       ./js/tail.select.js\r\n |  @author     SamBrishes <sam@pytes.net>\r\n |  @version    0.5.15 - Beta\r\n |\r\n |  @website    https://github.com/pytesNET/tail.select\r\n |  @license    X11 / MIT License\r\n |  @copyright  Copyright © 2014 - 2019 SamBrishes, pytesNET <info@pytes.net>\r\n */\r\n;(function(root, factory){\r\n    if(true){\r\n        !(__WEBPACK_AMD_DEFINE_RESULT__ = (function(){ return factory(root); }).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n    } else {}\r\n}(window, function(root){\r\n    \"use strict\";\r\n    var w = root, d = root.document;\r\n\r\n    // Internal Helper Methods\r\n    function cHAS(el, name){\r\n        return (el && \"classList\" in el)? el.classList.contains(name): false;\r\n    }\r\n    function cADD(el, name){\r\n        return (el && \"classList\" in el)? el.classList.add(name): undefined;\r\n    }\r\n    function cREM(el, name){\r\n        return (el && \"classList\" in el)? el.classList.remove(name): undefined;\r\n    }\r\n    function trigger(el, event, opt){\r\n        if(CustomEvent && CustomEvent.name){\r\n            var ev = new CustomEvent(event, opt);\r\n        } else {\r\n            var ev = d.createEvent(\"CustomEvent\");\r\n            ev.initCustomEvent(event, !!opt.bubbles, !!opt.cancelable, opt.detail);\r\n        }\r\n        return el.dispatchEvent(ev);\r\n    }\r\n    function clone(obj, rep){\r\n        if(typeof Object.assign === \"function\"){\r\n            return Object.assign({}, obj, rep || {});\r\n        }\r\n        var clone = Object.constructor();\r\n        for(var key in obj){\r\n            clone[key] = (key in rep)? rep[key]: obj[key];\r\n        }\r\n        return clone;\r\n    }\r\n    function create(tag, classes){\r\n        var r = d.createElement(tag);\r\n            r.className = (classes && classes.join)? classes.join(\" \"): classes || \"\";\r\n        return r;\r\n    }\r\n\r\n    /*\r\n     |  SELECT CONSTRUCTOR\r\n     |  @since  0.5.12 [0.3.0]\r\n     */\r\n    var select = function(el, config){\r\n        el = (typeof(el) == \"string\")? d.querySelectorAll(el): el;\r\n        if(el instanceof NodeList || el instanceof HTMLCollection || el instanceof Array){\r\n            for(var _r = [], l = el.length, i = 0; i < l; i++){\r\n                _r.push(new select(el[i], clone(config, {})));\r\n            }\r\n            return (_r.length === 1)? _r[0]: ((_r.length === 0)? false: _r);\r\n        }\r\n        if(!(el instanceof Element) || !(this instanceof select)){\r\n            return !(el instanceof Element)? false: new select(el, config);\r\n        }\r\n\r\n        // Check Element\r\n        if(select.inst[el.getAttribute(\"data-tail-select\")]){\r\n            return select.inst[el.getAttribute(\"data-tail-select\")];\r\n        }\r\n        if(el.getAttribute(\"data-select\")){\r\n            var test = JSON.parse(el.getAttribute(\"data-select\").replace(/\\'/g, '\"'));\r\n            if(test instanceof Object){\r\n                config = clone(config, test); // This is a unofficial function ;3\r\n            }\r\n        }\r\n\r\n        // Get Element Options\r\n        var placeholder = el.getAttribute(\"placeholder\") || el.getAttribute(\"data-placeholder\"),\r\n            fb1 = \"bindSourceSelect\", fb2 = \"sourceHide\"; // Fallbacks\r\n        config = (typeof(config) == \"object\")? config: {};\r\n        config.multiple = (\"multiple\" in config)? config.multiple: el.multiple;\r\n        config.disabled = (\"disabled\" in config)? config.disabled: el.disabled;\r\n        config.placeholder = placeholder || config.placeholder || null;\r\n        config.width = (config.width === \"auto\")? el.offsetWidth + 50: config.width;\r\n        config.sourceBind = (fb1 in config)? config[fb1]: config.sourceBind || false;\r\n        config.sourceHide = (fb2 in config)? config[fb2]: config.sourceHide || true;\r\n        config.multiLimit = (config.multiLimit >= 0)? config.multiLimit: Infinity;\r\n\r\n        // Init Instance\r\n        this.e = el;\r\n        this.id = ++select.count;\r\n        this.con = clone(select.defaults, config);\r\n        this.events = {};\r\n        select.inst[\"tail-\" + this.id] = this;\r\n        return this.init().bind();\r\n    }, options;\r\n    select.version = \"0.5.15\";\r\n    select.status = \"beta\";\r\n    select.count = 0;\r\n    select.inst = {};\r\n\r\n    /*\r\n     |  STORAGE :: DEFAULT OPTIONS\r\n     */\r\n    select.defaults = {\r\n        animate: true,              // [0.3.0]      Boolean\r\n        classNames: null,           // [0.2.0]      Boolean, String, Array, null\r\n        csvOutput: false,           // [0.3.4]      Boolean\r\n        csvSeparator: \",\",          // [0.3.4]      String\r\n        descriptions: false,        // [0.3.0]      Boolean\r\n        deselect: false,            // [0.3.0]      Boolean\r\n        disabled: false,            // [0.5.0]      Boolean\r\n        height: 350,                // [0.2.0]      Integer, null\r\n        hideDisabled: false,        // [0.3.0]      Boolean\r\n        hideSelected: false,        // [0.3.0]      Boolean\r\n        items: {},                  // [0.3.0]      Object\r\n        locale: \"en\",               // [0.5.0]      String\r\n        linguisticRules: {          // [0.5.9]      Object\r\n            \"е\": \"ё\",\r\n            \"a\": \"ä\",\r\n            \"o\": \"ö\",\r\n            \"u\": \"ü\",\r\n            \"ss\": \"ß\"\r\n        },\r\n        multiple: false,            // [0.2.0]      Boolean\r\n        multiLimit: Infinity,       // [0.3.0]      Integer, Infinity\r\n        multiPinSelected: false,    // [0.5.0]      Boolean\r\n        multiContainer: false,      // [0.3.0]      Boolean, String\r\n        multiShowCount: true,       // [0.3.0]      Boolean\r\n        multiShowLimit: false,      // [0.5.0]      Boolean\r\n        multiSelectAll: false,      // [0.4.0]      Boolean\r\n        multiSelectGroup: true,     // [0.4.0]      Boolean\r\n        openAbove: null,            // [0.3.0]      Boolean, null\r\n        placeholder: null,          // [0.2.0]      String, null\r\n        search: false,              // [0.3.0]      Boolean\r\n        searchConfig: [             // [0.5.13]     Array\r\n            \"text\", \"value\"\r\n        ],\r\n        searchFocus: true,          // [0.3.0]      Boolean\r\n        searchMarked: true,         // [0.3.0]      Boolean\r\n        searchMinLength: 1,         // [0.5.13]     Integer\r\n        searchDisabled: true,       // [0.5.5]      Boolean\r\n        sortItems: false,           // [0.3.0]      String, Function, false\r\n        sortGroups: false,          // [0.3.0]      String, Function, false\r\n        sourceBind: false,          // [0.5.0]      Boolean\r\n        sourceHide: true,           // [0.5.0]      Boolean\r\n        startOpen: false,           // [0.3.0]      Boolean\r\n        stayOpen: false,            // [0.3.0]      Boolean\r\n        width: null,                // [0.2.0]      Integer, String, null\r\n        cbComplete: undefined,      // [0.5.0]      Function\r\n        cbEmpty: undefined,         // [0.5.0]      Function\r\n        cbLoopItem: undefined,      // [0.4.0]      Function\r\n        cbLoopGroup: undefined      // [0.4.0]      Function\r\n    };\r\n\r\n    /*\r\n     |  STORAGE :: STRINGS\r\n     */\r\n    select.strings = {\r\n        en: {\r\n            all: \"All\",\r\n            none: \"None\",\r\n            empty: \"No Options available\",\r\n            emptySearch: \"No Options found\",\r\n            limit: \"You can't select more Options\",\r\n            placeholder: \"Select an Option...\",\r\n            placeholderMulti: \"Select up to :limit Options...\",\r\n            search: \"Type in to search...\",\r\n            disabled: \"This Field is disabled\"\r\n        },\r\n        modify: function(locale, id, string){\r\n            if(!(locale in this)){\r\n                return false;\r\n            }\r\n            if((id instanceof Object)){\r\n                for(var key in id){\r\n                    this.modify(locale, key, id[key]);\r\n                }\r\n            } else {\r\n                this[locale][id] = (typeof(string) == \"string\")? string: this[locale][id];\r\n            }\r\n            return true;\r\n        },\r\n        register: function(locale, object){\r\n            if(typeof(locale) != \"string\" || !(object instanceof Object)){\r\n                return false;\r\n            }\r\n            this[locale] = object;\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /*\r\n     |  TAIL.SELECT HANDLER\r\n     */\r\n    select.prototype = {\r\n        /*\r\n         |  INERNAL :: TRANSLATE\r\n         |  @since  0.5.8 [0.5.8]\r\n         */\r\n        _e: function(string, replace, def){\r\n            if(!(string in this.__)){\r\n                return (!def)? string: def;\r\n            }\r\n\r\n            var string = this.__[string];\r\n            if(typeof(string) === \"function\"){\r\n                string = string.call(this, replace);\r\n            }\r\n            if(typeof(replace) === \"object\"){\r\n                for(var key in replace){\r\n                    string = string.replace(key, replace[key]);\r\n                }\r\n            }\r\n            return string;\r\n        },\r\n\r\n        /*\r\n         |  INTERNAL :: INIT SELECT FIELD\r\n         |  @since  0.5.13 [0.3.0]\r\n         */\r\n        init: function(){\r\n            var self = this, classes = [\"tail-select\"], con = this.con,\r\n                regexp = /^[0-9.]+(?:cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|\\%)$/i;\r\n\r\n            // Init ClassNames\r\n            var c = (con.classNames === true)? this.e.className: con.classNames;\r\n            classes.push((c && c.push)? c.join(\" \"): (c && c.split)? c: \"no-classes\");\r\n            if(con.hideSelected){    classes.push(\"hide-selected\"); }\r\n            if(con.hideDisabled){    classes.push(\"hide-disabled\"); }\r\n            if(con.multiLimit == 0){ classes.push(\"disabled\");      }\r\n            if(con.multiple){        classes.push(\"multiple\");      }\r\n            if(con.deselect){        classes.push(\"deselect\");      }\r\n            if(con.disabled){        classes.push(\"disabled\");      }\r\n\r\n            // Init Variables\r\n            this.__ = clone(select.strings.en, select.strings[con.locale] || {});\r\n            this._init = true;\r\n            this._query = false;\r\n            this.select = create(\"DIV\", classes);\r\n            this.label = create(\"DIV\", \"select-label\");\r\n            this.dropdown = create(\"DIV\", \"select-dropdown\");\r\n            this.search = create(\"DIV\", \"dropdown-search\");\r\n            this.csvInput = create(\"INPUT\", \"select-search\");\r\n\r\n            // Build :: Select\r\n            if(this.e.getAttribute(\"tabindex\") !== null){\r\n                this.select.setAttribute(\"tabindex\", this.e.getAttribute(\"tabindex\"));\r\n            } else {\r\n                this.select.setAttribute(\"tabindex\", 0);\r\n            }\r\n            if(con.width && regexp.test(con.width)){\r\n                this.select.style.width = con.width;\r\n            } else if(con.width && !isNaN(parseFloat(con.width, 10))){\r\n                this.select.style.width = con.width + \"px\";\r\n            }\r\n\r\n            // Build :: Label\r\n            this.label.addEventListener(\"click\", function(event){\r\n                self.toggle.call(self, self.con.animate);\r\n            });\r\n            this.select.appendChild(this.label);\r\n\r\n            // Build :: Dropdown\r\n            if(!isNaN(parseInt(con.height, 10))){\r\n                this.dropdown.style.maxHeight = parseInt(con.height, 10) + \"px\";\r\n            }\r\n            if(con.search){\r\n                this.search.innerHTML = '<input type=\"text\" class=\"search-input\" />';\r\n                this.search.children[0].placeholder = this._e(\"search\");\r\n                this.search.children[0].addEventListener(\"input\", function(event){\r\n                    self.query.call(self, (this.value.length > con.searchMinLength)? this.value: undefined);\r\n                });\r\n                this.dropdown.appendChild(this.search);\r\n            }\r\n            this.select.appendChild(this.dropdown);\r\n\r\n            // Build :: CSV Input\r\n            this.csvInput.type = \"hidden\";\r\n            if(con.csvOutput){\r\n                this.csvInput.name = this.e.name;\r\n                this.e.removeAttribute(\"name\");\r\n                this.select.appendChild(this.csvInput);\r\n            }\r\n\r\n            // Prepare Container\r\n            if(con.multiple && con.multiContainer){\r\n                if(d.querySelector(con.multiContainer)){\r\n                    this.container = d.querySelector(con.multiContainer);\r\n                    this.container.className += \" tail-select-container\";\r\n                } else if(con.multiContainer === true){\r\n                    this.container = this.label;\r\n                    this.container.className += \" tail-select-container\";\r\n                }\r\n            }\r\n\r\n            // Prepare Options\r\n            this.options = new options(this.e, this);\r\n            for(var l = this.e.options.length, i = 0; i < l; i++){\r\n                this.options.set(this.e.options[i], false);\r\n            }\r\n            for(var key in con.items){\r\n                if(typeof(con.items[key]) == \"string\"){\r\n                    con.items[key] = {value: con.items[key]};\r\n                }\r\n                this.options.add(con.items[key].key || key, con.items[key].value,\r\n                    con.items[key].group, con.items[key].selected,\r\n                    con.items[key].disabled, con.items[key].description);\r\n            }\r\n            this.query();\r\n\r\n            // Append and Return\r\n            if(this.e.nextElementSibling){\r\n                this.e.parentElement.insertBefore(this.select, this.e.nextElementSibling);\r\n            } else {\r\n                this.e.parentElement.appendChild(this.select);\r\n            }\r\n            if(con.sourceHide){\r\n                if(this.e.style.display == \"none\"){\r\n                    this.select.style.display = \"none\";\r\n                    this.e.setAttribute(\"data-select-hidden\", \"display\");\r\n                } else if(this.e.style.visibility == \"hidden\"){\r\n                    this.select.style.visibiltiy = \"hidden\";\r\n                    this.e.setAttribute(\"data-select-hidden\", \"visibility\");\r\n                } else {\r\n                    this.e.style.display = \"none\";\r\n                    this.e.setAttribute(\"data-select-hidden\", \"0\");\r\n                }\r\n            }\r\n            this.e.setAttribute(\"data-tail-select\", \"tail-\" + this.id);\r\n            if(self.con.startOpen){\r\n                this.open(con.animate);\r\n            }\r\n            (con.cbComplete || function(){ }).call(this, this.select);\r\n            return (this._init = false)? this: this;\r\n        },\r\n\r\n        /*\r\n         |  INTERNAL :: EVENT LISTENER\r\n         |  @since  0.5.13 [0.3.0]\r\n         */\r\n        bind: function(){\r\n            var self = this;\r\n\r\n            // Keys Listener\r\n            d.addEventListener(\"keydown\", function(event){\r\n                var key = (event.keyCode || event.which), opt, inner, e, temp, tmp;\r\n                var space = (key == 32 && self.select === document.activeElement);\r\n                if(!space && (!cHAS(self.select, \"active\") || [13, 27, 38, 40].indexOf(key) < 0)){\r\n                    return false;\r\n                }\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n\r\n                // Space\r\n                if(key === 32){\r\n                    return self.open(self.con.animate);\r\n                }\r\n\r\n                // Enter || Escape\r\n                if(key == 13){\r\n                    if((opt = self.dropdown.querySelector(\".dropdown-option.hover:not(.disabled)\"))){\r\n                        self.options.select.call(self.options, opt);\r\n                    }\r\n                }\r\n                if(key == 27 || key == 13){\r\n                    return self.close(self.con.animate);\r\n                }\r\n\r\n                // Top || Down\r\n                if((opt = self.dropdown.querySelector(\".dropdown-option.hover:not(.disabled)\"))){\r\n                    cREM(opt, \"hover\"); e = [((key == 40)? \"next\": \"previous\") + \"ElementSibling\"];\r\n                    do {\r\n                        if((temp = opt[e]) !== null && opt.tagName == \"LI\"){\r\n                            opt = temp;\r\n                        } else if((temp = opt.parentElement[e]) !== null && temp.children.length > 0 && temp.tagName == \"UL\"){\r\n                            opt = temp.children[(key == 40)? 0: temp.children.length-1];\r\n                        } else {\r\n                            opt = false;\r\n                        }\r\n                        if(opt && (!cHAS(opt, \"dropdown-option\") || cHAS(opt, \"disabled\"))){\r\n                            continue;\r\n                        }\r\n                        break;\r\n                    } while(true);\r\n                }\r\n                if(!opt && key == 40){\r\n                    opt = self.dropdown.querySelector(\".dropdown-option:not(.disabled)\");\r\n                } else if(!opt && key == 38){\r\n                    tmp = self.dropdown.querySelectorAll(\".dropdown-option:not(.disabled)\");\r\n                    opt = tmp[tmp.length - 1];\r\n                }\r\n                if(opt && (inner = self.dropdown.querySelector(\".dropdown-inner\"))){\r\n                    var pos = (function(el){\r\n                        var _r = {top: el.offsetTop, height: el.offsetHeight};\r\n                        while((el = el.parentElement) != inner){\r\n                            _r.top += el.offsetTop;\r\n                        }\r\n                        return _r;\r\n                    })(opt);\r\n                    cADD(opt, \"hover\");\r\n                    inner.scrollTop = Math.max(0, pos.top - (pos.height * 2));\r\n                }\r\n                return true;\r\n            });\r\n\r\n            // Close\r\n            d.addEventListener(\"click\", function(ev){\r\n                if(!cHAS(self.select, \"active\") || cHAS(self.select, \"idle\")){ return false; }\r\n                if(self.con.stayOpen === true){ return false; }\r\n\r\n                var targets = [self.e, self.select, self.container];\r\n                for(var l = targets.length, i = 0; i < l; i++){\r\n                    if(targets[i] && (targets[i].contains(ev.target) || targets[i] == ev.target)){\r\n                        return false;\r\n                    }\r\n                    if(!ev.target.parentElement){ return false; }\r\n                }\r\n                return self.close.call(self, self.con.animate);\r\n            });\r\n\r\n            // Bind Source Select\r\n            if(!this.con.sourceBind){\r\n                return true;\r\n            }\r\n            this.e.addEventListener(\"change\", function(event){\r\n                if(event.detail != undefined){\r\n                    return false;\r\n                }\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                if(!this.multiple && this.selectedIndex){\r\n                    self.options.select.call(self.options, this.options[this.selectedIndex]);\r\n                } else {\r\n                    var u = [].concat(self.options.selected);\r\n                    var s = [].filter.call(this.querySelectorAll(\"option:checked\"), function(item){\r\n                        if(u.indexOf(item) >= 0){\r\n                            u.splice(u.indexOf(item), 1);\r\n                            return false;\r\n                        }\r\n                        return true;\r\n                    });\r\n                    self.options.walk.call(self.options, \"unselect\", u);\r\n                    self.options.walk.call(self.options, \"select\", s);\r\n                }\r\n            });\r\n            return true;\r\n        },\r\n\r\n        /*\r\n         |  INTERNAL :: INTERNAL CALLBACK\r\n         |  @since  0.5.14 [0.3.0]\r\n         */\r\n        callback: function(item, state, _force){\r\n            var rkey = item.key.replace(/('|\\\\)/g, \"\\\\$1\"),\r\n                rgrp = item.group.replace(/('|\\\\)/g, \"\\\\$1\"),\r\n                rsel = \"[data-key='\" + rkey + \"'][data-group='\" + rgrp + \"']\";\r\n            if(state == \"rebuild\"){ return this.query(); }\r\n\r\n            // Set Element-Item States\r\n            var element = this.dropdown.querySelector(rsel);\r\n            if(element && [\"select\", \"disable\"].indexOf(state) >= 0){\r\n                cADD(element, (state == \"select\"? \"selected\": \"disabled\"));\r\n            } else if(element && [\"unselect\", \"enable\"].indexOf(state) >= 0){\r\n                cREM(element, (state == \"unselect\"? \"selected\": \"disabled\"));\r\n            }\r\n\r\n            // Handle\r\n            this.update(item);\r\n            return (_force === true)? true: this.trigger(\"change\", item, state);\r\n        },\r\n\r\n        /*\r\n         |  INTERNAL :: TRIGGER EVENT HANDLER\r\n         |  @since  0.5.2 [0.4.0]\r\n         */\r\n        trigger: function(event){\r\n            if(this._init){ return false; }\r\n            var obj = {bubbles: false, cancelable: true, detail: {args: arguments, self: this}};\r\n            if(event == \"change\" && arguments[2] && arguments[2].indexOf(\"select\") >= 0){\r\n                trigger(this.e, \"input\", obj);\r\n                trigger(this.e, \"change\", obj);\r\n            }\r\n            trigger(this.select, \"tail::\" + event, obj);\r\n\r\n            var args = [], pass;\r\n            Array.prototype.map.call(arguments, function(item, i){\r\n                if(i > 0){ args.push(item); }\r\n            });\r\n            (this.events[event] || []).forEach(function(item){\r\n                pass = [].concat(args);\r\n                pass.push(item.args || null);\r\n                (item.cb || function(){ }).apply(obj.detail.self, pass);\r\n            });\r\n            return true;\r\n        },\r\n\r\n        /*\r\n         |  INTERNAL :: CALCULATE DROPDOWN\r\n         |  @since  0.5.4 [0.5.0]\r\n         */\r\n        calc: function(){\r\n            var clone = this.dropdown.cloneNode(true), height = this.con.height, search = 0,\r\n                inner = this.dropdown.querySelector(\".dropdown-inner\");\r\n\r\n            // Calculate Dropdown Height\r\n            clone = this.dropdown.cloneNode(true);\r\n            clone.style.cssText = \"height:auto;min-height:auto;max-height:none;opacity:0;display:block;visibility:hidden;\";\r\n            clone.style.maxHeight = this.con.height + \"px\";\r\n            clone.className += \" cloned\";\r\n            this.dropdown.parentElement.appendChild(clone);\r\n            height = (height > clone.clientHeight)? clone.clientHeight: height;\r\n            if(this.con.search){\r\n                search = clone.querySelector(\".dropdown-search\").clientHeight;\r\n            }\r\n            this.dropdown.parentElement.removeChild(clone);\r\n\r\n            // Calculate Viewport\r\n            var pos = this.select.getBoundingClientRect(),\r\n                bottom = w.innerHeight-(pos.top+pos.height),\r\n                view = ((height+search) > bottom)? pos.top > bottom: false;\r\n            if(this.con.openAbove === true || (this.con.openAbove !== false && view)){\r\n                view = true, height = Math.min((height), pos.top-10);\r\n                cADD(this.select, \"open-top\");\r\n            } else {\r\n                view = false, height = Math.min((height), bottom-10);\r\n                cREM(this.select, \"open-top\");\r\n            }\r\n            if(inner){\r\n                this.dropdown.style.maxHeight = height + \"px\";\r\n                inner.style.maxHeight = (height-search) + \"px\";\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  API :: QUERY OPTIONS\r\n         |  @since  0.5.13 [0.5.0]\r\n         */\r\n        query: function(search, conf){\r\n            var item, tp, ul, li, a1, a2;                           // Pre-Definition\r\n            var self = this, con = this.con, g = \"getAttribute\";    // Shorties\r\n            var root = create(\"DIV\", \"dropdown-inner\"),             // Contexts\r\n                func = (!search)? \"walker\": \"finder\",\r\n                args = (!search)? [con.sortItems, con.sortGroups]: [search, conf];\r\n\r\n            // Option Walker\r\n            this._query = (typeof(search) == \"string\")? search: false;\r\n            while(item = this.options[func].apply(this.options, args)){\r\n                if(!ul || (ul && ul[g](\"data-group\") !== item.group)){\r\n                    tp = (con.cbLoopGroup || this.cbGroup).call(this, item.group, search, root);\r\n                    if(tp instanceof Element){\r\n                        ul = tp;\r\n                        ul.setAttribute(\"data-group\", item.group);\r\n                        root.appendChild(ul);\r\n                    } else { break; }\r\n                }\r\n\r\n                // Create Item\r\n                if((li = (con.cbLoopItem || this.cbItem).call(this, item, ul, search, root)) === null){\r\n                    continue;\r\n                }\r\n                if(li === false){ break; }\r\n                li.setAttribute(\"data-key\", item.key);\r\n                li.setAttribute(\"data-group\", item.group);\r\n                li.addEventListener(\"click\", function(event){\r\n                    if(!this.hasAttribute(\"data-key\")){ return false; }\r\n                    var key = this[g](\"data-key\"), group = this[g](\"data-group\") || \"#\";\r\n                    if(self.options.toggle.call(self.options, key, group)){\r\n                        if(self.con.stayOpen === false && !self.con.multiple){\r\n                            self.close.call(self, self.con.animate);\r\n                        }\r\n                    }\r\n                });\r\n                ul.appendChild(li);\r\n            }\r\n\r\n            // Empty\r\n            var count = root.querySelectorAll(\"*[data-key]\").length;\r\n            if(count == 0){\r\n                (this.con.cbEmpty || function(element){\r\n                    var li = create(\"SPAN\", \"dropdown-empty\");\r\n                    li.innerText = this._e(\"empty\");\r\n                    element.appendChild(li);\r\n                }).call(this, root, search);\r\n            }\r\n\r\n            // Select All\r\n            if(count > 0 && con.multiple && con.multiLimit == Infinity && con.multiSelectAll){\r\n                a1 = create(\"BUTTON\", \"tail-all\"), a2 = create(\"BUTTON\", \"tail-none\");\r\n                a1.innerText = this._e(\"all\");\r\n                a1.addEventListener(\"click\", function(event){\r\n                    event.preventDefault();\r\n                    var options = self.dropdown.querySelectorAll(\".dropdown-inner .dropdown-option\");\r\n                    self.options.walk.call(self.options, \"select\", options);\r\n                })\r\n                a2.innerText = this._e(\"none\");\r\n                a2.addEventListener(\"click\", function(event){\r\n                    event.preventDefault();\r\n                    var options = self.dropdown.querySelectorAll(\".dropdown-inner .dropdown-option\");\r\n                    self.options.walk.call(self.options, \"unselect\", options);\r\n                })\r\n\r\n                // Add Element\r\n                li = create(\"SPAN\", \"dropdown-action\");\r\n                li.appendChild(a1);\r\n                li.appendChild(a2);\r\n                root.insertBefore(li, root.children[0]);\r\n            }\r\n\r\n            // Add and Return\r\n            var data = this.dropdown.querySelector(\".dropdown-inner\");\r\n            this.dropdown[(data? \"replace\": \"append\") + \"Child\"](root, data);\r\n            if(cHAS(this.select, \"active\")){\r\n                this.calc();\r\n            }\r\n            return this.updateCSV().updateLabel();\r\n        },\r\n\r\n        /*\r\n         |  API :: CALLBACK -> CREATE GROUP\r\n         |  @since  0.5.8 [0.4.0]\r\n         */\r\n        cbGroup: function(group, search){\r\n            var ul = create(\"UL\", \"dropdown-optgroup\"), self = this, a1, a2;\r\n            if(group == \"#\"){ return ul; }\r\n            ul.innerHTML = '<li class=\"optgroup-title\"><b>' + group + '</b></li>';\r\n            if(this.con.multiple && this.con.multiLimit == Infinity && this.con.multiSelectAll){\r\n                a1 = create(\"BUTTON\", \"tail-none\"), a2 = create(\"BUTTON\", \"tail-all\");\r\n                a1.innerText = this._e(\"none\");\r\n                a1.addEventListener(\"click\", function(event){\r\n                    event.preventDefault();\r\n                    var grp = this.parentElement.parentElement.getAttribute(\"data-group\");\r\n                    self.options.all.call(self.options, \"unselect\", grp);\r\n                });\r\n                a2.innerText = this._e(\"all\");\r\n                a2.addEventListener(\"click\", function(event){\r\n                    event.preventDefault();\r\n                    var grp = this.parentElement.parentElement.getAttribute(\"data-group\");\r\n                    self.options.all.call(self.options, \"select\", grp);\r\n                });\r\n                ul.children[0].appendChild(a1);\r\n                ul.children[0].appendChild(a2);\r\n            }\r\n            return ul;\r\n        },\r\n\r\n        /*\r\n         |  API :: CALLBACK -> CREATE ITEM\r\n         |  @since  0.5.13 [0.4.0]\r\n         */\r\n        cbItem: function(item, optgroup, search){\r\n            var li = create(\"LI\", \"dropdown-option\" + (item.selected? \" selected\": \"\") + (item.disabled? \" disabled\": \"\"));\r\n\r\n            // Inner Text\r\n            if(search && search.length > 0 && this.con.searchMarked){\r\n                search = this.options.applyLinguisticRules(search);\r\n                li.innerHTML = item.value.replace(new RegExp(\"(\" + search + \")\", \"i\"), \"<mark>$1</mark>\");\r\n            } else {\r\n                li.innerText = item.value;\r\n            }\r\n\r\n            // Inner Description\r\n            if(this.con.descriptions && item.description){\r\n                li.innerHTML += '<span class=\"option-description\">' + item.description + '</span>';\r\n            }\r\n            return li;\r\n        },\r\n\r\n        /*\r\n         |  API :: UPDATE EVERYTHING\r\n         |  @since  0.5.0 [0.5.0]\r\n         */\r\n        update: function(item){\r\n            return this.updateLabel().updateContainer(item).updatePin(item).updateCSV(item);\r\n        },\r\n\r\n        /*\r\n         |  API :: UPDATE LABEL\r\n         |  @since  0.5.8 [0.5.0]\r\n         */\r\n        updateLabel: function(label){\r\n            if(this.container == this.label && this.options.selected.length > 0){\r\n                if(this.label.querySelector(\".label-inner\")){\r\n                    this.label.removeChild(this.label.querySelector(\".label-inner\"));\r\n                }\r\n                if(this.label.querySelector(\".label-count\")){\r\n                    this.label.removeChild(this.label.querySelector(\".label-count\"));\r\n                }\r\n                return this;\r\n            }\r\n            var c = this.con, len = this.options.selected.length, limit;\r\n            if(typeof(label) != \"string\"){\r\n                if(c.disabled){\r\n                    label = \"disabled\";\r\n                } else if(this.dropdown.querySelectorAll(\"*[data-key]\").length == 0){\r\n                    label = \"empty\" + (cHAS(this.select, \"in-search\")? \"Search\": \"\");\r\n                } else if(c.multiLimit <= len){\r\n                    label = \"limit\";\r\n                } else if(!c.multiple && this.options.selected.length > 0){\r\n                    label = this.options.selected[0].innerText;\r\n                } else if(typeof(c.placeholder) == \"string\"){\r\n                    label = c.placeholder;\r\n                } else {\r\n                    label = \"placeholder\" + (c.multiple && c.multiLimit < Infinity? \"Multi\": \"\");\r\n                }\r\n            }\r\n\r\n            // Set HTML\r\n            label = this._e(label, {\":limit\": c.multiLimit}, label);\r\n            label = '<span class=\"label-inner\">' + label + '</span>',\r\n            limit = (c.multiShowLimit && c.multiLimit < Infinity);\r\n            if(c.multiple && c.multiShowCount){\r\n                label = '<span class=\"label-count\">:c</span>' + label;\r\n                label = label.replace(\":c\", len + (limit? (\" / \" + c.multiLimit): \"\"));\r\n            }\r\n            this.label.innerHTML = label;\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  API :: UPDATE CONTAINER\r\n         |  @since  0.5.0 [0.5.0]\r\n         */\r\n        updateContainer: function(item){\r\n            if(!this.container || !this.con.multiContainer){\r\n                return this;\r\n            }\r\n            var s = \"[data-group='\" + item.group + \"'][data-key='\" + item.key + \"']\";\r\n            if(this.container.querySelector(s)){\r\n                if(!item.selected){\r\n                    this.container.removeChild(this.container.querySelector(s));\r\n                }\r\n                return this;\r\n            }\r\n\r\n            // Create Item\r\n            if(item.selected){\r\n                var self = this, hndl = create(\"DIV\", \"select-handle\");\r\n                hndl.innerText = item.value;\r\n                hndl.setAttribute(\"data-key\", item.key);\r\n                hndl.setAttribute(\"data-group\", item.group);\r\n                hndl.addEventListener(\"click\", function(event){\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                    var key = this.getAttribute(\"data-key\"), grp = this.getAttribute(\"data-group\");\r\n                    self.options.unselect.call(self.options, key, grp);\r\n                });\r\n                this.container.appendChild(hndl);\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  API :: UPDATE PIN POSITION\r\n         |  @since  0.5.3 [0.5.0]\r\n         */\r\n        updatePin: function(item){\r\n            var inner = this.dropdown.querySelector(\".dropdown-inner ul\"),\r\n                option = \"li[data-key='\" + item.key + \"'][data-group='\" + item.group + \"']\";\r\n            if(!this.con.multiPinSelected || !inner || this._query !== false){\r\n                return this;\r\n            }\r\n\r\n            // Create Item\r\n            option = this.dropdown.querySelector(option);\r\n            if(item.selected){\r\n                inner.insertBefore(option, inner.children[0]);\r\n            } else {\r\n                var grp = this.dropdown.querySelector(\"ul[data-group='\" + item.group + \"']\"),\r\n                    prev = this.options[item.index-1], found = false;\r\n                while(prev && prev.group == item.group){\r\n                    if(found = grp.querySelector(\"li[data-key='\" + prev.key + \"']\")){\r\n                        break;\r\n                    }\r\n                    prev = this.options[prev.index-1];\r\n                }\r\n                if(found && found.nextElementSibling){\r\n                    grp.insertBefore(option, found.nextElementSibling);\r\n                } else {\r\n                    grp.appendChild(option);\r\n                }\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  API :: UPDATE CSV INPUT\r\n         |  @since  0.5.0 [0.5.0]\r\n         */\r\n        updateCSV: function(item){\r\n            if(!this.csvInput || !this.con.csvOutput){\r\n                return this;\r\n            }\r\n            for(var selected = [], l = this.options.selected.length, i = 0; i < l; i++){\r\n                selected.push(this.options.selected[i].value);\r\n            }\r\n            this.csvInput.value = selected.join(this.con.csvSeparator || \",\");\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: OPEN DROPDOWN\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        open: function(animate){\r\n            if(cHAS(this.select, \"active\") || cHAS(this.select, \"idle\") || this.con.disabled){\r\n                return false;\r\n            }\r\n            this.calc();\r\n\r\n            // Final Function\r\n            var final = function(){\r\n                cADD(self.select, \"active\");\r\n                cREM(self.select, \"idle\");\r\n                this.dropdown.style.height = \"auto\";\r\n                this.dropdown.style.overflow = \"visible\";\r\n                this.label.removeAttribute(\"style\");\r\n                if(this.con.search && this.con.searchFocus){\r\n                    this.dropdown.querySelector(\"input\").focus();\r\n                }\r\n                this.trigger.call(this, \"open\");\r\n            }, self = this, e = this.dropdown.style;\r\n\r\n            // Open\r\n            if(animate !== false){\r\n                this.label.style.zIndex = 25;\r\n                this.dropdown.style.cssText += \"height:0;display:block;overflow:hidden;\";\r\n                cADD(self.select, \"idle\");\r\n                (function animate(){\r\n                    var h = parseInt(e.height, 10), m = parseInt(e.maxHeight, 10);\r\n                    if(h >= m){\r\n                        return final.call(self);\r\n                    }\r\n                    e.height = ((h+50 > m)? m: h+50) + \"px\";\r\n                    setTimeout(animate, 20);\r\n                })();\r\n            } else {\r\n                e.cssText = \"height:\" + e.maxHeight + \";display:block;overflow:hidden;\";\r\n                final.call(this);\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: CLOSE DROPDOWN\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        close: function(animate){\r\n            if(!cHAS(this.select, \"active\") || cHAS(this.select, \"idle\")){\r\n                return false;\r\n            }\r\n            var final = function(){\r\n                cREM(this.select, \"active\");\r\n                cREM(this.select, \"idle\");\r\n                this.dropdown.removeAttribute(\"style\");\r\n                this.dropdown.querySelector(\".dropdown-inner\").removeAttribute(\"style\");\r\n                this.trigger.call(this, \"close\");\r\n            }, self = this, e = this.dropdown;\r\n\r\n            // Close\r\n            if(animate !== false){\r\n                cADD(this.select, \"idle\");\r\n                this.dropdown.style.overflow = \"hidden\";\r\n                (function animate(){\r\n                    if((parseInt(e.offsetHeight, 10)-50) <= 0){\r\n                        return final.call(self);\r\n                    }\r\n                    e.style.height = (parseInt(e.offsetHeight, 10)-50) + \"px\";\r\n                    setTimeout(animate, 20);\r\n                })();\r\n            } else {\r\n                final.call(this);\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: TOGGLE DROPDOWN\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        toggle: function(animate){\r\n            if(cHAS(this.select, \"active\")){\r\n                return this.close(animate);\r\n            }\r\n            return !cHAS(this.select, \"idle\")? this.open(animate): this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: REMOVE SELECT\r\n         |  @since  0.5.3 [0.3.0]\r\n         */\r\n        remove: function(){\r\n            this.e.removeAttribute(\"data-tail-select\");\r\n            if(this.e.hasAttribute(\"data-select-hidden\")){\r\n                if(this.e.getAttribute(\"data-select-hidden\") == \"0\"){\r\n                    this.e.style.removeProperty(\"display\");\r\n                }\r\n                this.e.removeAttribute(\"data-select-hidden\");\r\n            }\r\n            Array.prototype.map.call(this.e.querySelectorAll(\"[data-select-option='add']\"), function(item){\r\n                item.parentElement.removeChild(item);\r\n            })\r\n            Array.prototype.map.call(this.e.querySelectorAll(\"[data-select-optgroup='add']\"), function(item){\r\n                item.parentElement.removeChild(item);\r\n            })\r\n            this.e.name = (this.csvInput.hasAttribute(\"name\"))? this.csvInput.name: this.e.name;\r\n            if(this.select.parentElement){\r\n                this.select.parentElement.removeChild(this.select);\r\n            }\r\n            if(this.container){\r\n                var handles = this.container.querySelectorAll(\".select-handle\");\r\n                for(var l = handles.length, i = 0; i < l; i++){\r\n                    this.container.removeChild(handles[i]);\r\n                }\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: RELOAD SELECT\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        reload: function(){\r\n            return this.remove().init();\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: GET|SET CONFIG\r\n         |  @since  0.5.15 [0.4.0]\r\n         */\r\n        config: function(key, value, rebuild){\r\n            if(key instanceof Object){\r\n                for(var k in key){ this.config(k, key[k], false); }\r\n                return this.reload()? this.con: this.con;\r\n            }\r\n            if(typeof(key) == \"undefined\"){\r\n                return this.con;\r\n            } else if(!(key in this.con)){\r\n                return false;\r\n            }\r\n\r\n            // Set | Return\r\n            if(typeof(value) == \"undefined\"){\r\n                return this.con[key];\r\n            }\r\n            this.con[key] = value;\r\n            if(rebuild !== false){\r\n                this.reload();\r\n            }\r\n            return this;\r\n        },\r\n        enable: function(update){\r\n            cREM(this.select, \"disabled\");\r\n            this.e.disabled = false;\r\n            this.con.disabled = false;\r\n            return (update === false)? this: this.reload();\r\n        },\r\n        disable: function(update){\r\n            cADD(this.select, \"disabled\");\r\n            this.e.disabled = true;\r\n            this.con.disabled = true;\r\n            return (update === false)? this: this.reload();\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: CUSTOM EVENT LISTENER\r\n         |  @since  0.5.0 [0.4.0]\r\n         */\r\n        on: function(event, callback, args){\r\n            if([\"open\", \"close\", \"change\"].indexOf(event) < 0 || typeof(callback) != \"function\"){\r\n                return false;\r\n            }\r\n            if(!(event in this.events)){\r\n                this.events[event] = [];\r\n            }\r\n            this.events[event].push({cb: callback, args: (args instanceof Array)? args: []});\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  PUBLIC :: VALUE\r\n         |  @since  0.5.13 [0.5.13]\r\n         */\r\n        value: function(){\r\n            if(this.options.selected.length == 0){\r\n                return null;\r\n            }\r\n            if(this.con.multiple){\r\n                return this.options.selected.map(function(opt){\r\n                    return opt.value;\r\n                });\r\n            }\r\n            return this.options.selected[0].value;\r\n        }\r\n    };\r\n\r\n    /*\r\n     |  OPTIONS CONSTRUCTOR\r\n     |  @since  0.5.12 [0.3.0]\r\n     */\r\n    options = select.options = function(select, parent){\r\n        if(!(this instanceof options)){\r\n            return new options(select, parent);\r\n        }\r\n        this.self = parent;\r\n        this.element = select;\r\n        this.length = 0;\r\n        this.selected = [];\r\n        this.disabled = [];\r\n        this.items = {\"#\": {}};\r\n        this.groups = {};\r\n        return this;\r\n    }\r\n\r\n    /*\r\n     |  TAIL.OPTIONS HANDLER\r\n     */\r\n    options.prototype = {\r\n        /*\r\n         |  INTERNAL :: REPLACE TYPOs\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        _r: function(state){\r\n            return state.replace(\"disabled\", \"disable\").replace(\"enabled\", \"enable\")\r\n                        .replace(\"selected\", \"select\").replace(\"unselected\", \"unselect\");\r\n        },\r\n\r\n        /*\r\n         |  GET AN EXISTING OPTION\r\n         |  @since  0.5.7 [0.3.0]\r\n         */\r\n        get: function(key, grp){\r\n            var g = \"getAttribute\";\r\n            if(typeof(key) == \"object\" && key.key && key.group){\r\n                grp = key.group || grp;\r\n                key = key.key;\r\n            } else if(key instanceof Element){\r\n                if(key.tagName == \"OPTION\"){\r\n                    grp = key.parentElement.label || \"#\";\r\n                    key = key.value || key.innerText;\r\n                } else if(key.hasAttribute(\"data-key\")){\r\n                    grp = key[g](\"data-group\") || key.parentElement[g](\"data-group\") || \"#\";\r\n                    key = key[g](\"data-key\");\r\n                }\r\n            } else if(typeof(key) != \"string\"){\r\n                return false;\r\n            }\r\n            key = (/^[0-9]+$/.test(key))? \"_\" + key: key;\r\n            return (grp in this.items)? this.items[grp][key]: false;\r\n        },\r\n\r\n        /*\r\n         |  SET AN EXISTING OPTION\r\n         |  @since  0.5.15 [0.3.0]\r\n         */\r\n        set: function(opt, rebuild){\r\n            var key = opt.value || opt.innerText, grp = opt.parentElement.label || \"#\";\r\n            if(!(grp in this.items)){\r\n                this.items[grp] = {};\r\n                this.groups[grp] = opt.parentElement;\r\n            }\r\n            if(key in this.items[grp]){\r\n                return false;\r\n            }\r\n            var id = (/^[0-9]+$/.test(key))? \"_\" + key: key;\r\n\r\n            // Validate Selection\r\n            var con = this.self.con;\r\n            if(con.multiple && this.selected.length >= con.multiLimit){\r\n                opt.selected = false;\r\n            }\r\n            if(opt.selected && con.deselect && (!opt.hasAttribute(\"selected\") || con.multiLimit == 0)){\r\n                opt.selected = false;\r\n                opt.parentElement.selectedIndex = -1;\r\n            }\r\n\r\n            // Sanitize Description\r\n            if(opt.hasAttribute(\"data-description\")){\r\n                var span = create(\"SPAN\");\r\n                    span.innerHTML = opt.getAttribute(\"data-description\");\r\n                opt.setAttribute(\"data-description\", span.innerHTML);\r\n            }\r\n\r\n            // Add Item\r\n            this.items[grp][id] = {\r\n                key: key,\r\n                value: opt.text,\r\n                description: opt.getAttribute(\"data-description\") || null,\r\n                group: grp,\r\n                option: opt,\r\n                optgroup: (grp != \"#\")? this.groups[grp]: undefined,\r\n                selected: opt.selected,\r\n                disabled: opt.disabled,\r\n                hidden: opt.hidden || false\r\n            };\r\n            this.length++;\r\n            if(opt.selected){ this.select(this.items[grp][id]); }\r\n            if(opt.disabled){ this.disable(this.items[grp][id]); }\r\n            return (rebuild)? this.self.callback(this.items[grp][key], \"rebuild\"): true;\r\n        },\r\n\r\n        /*\r\n         |  CREATE A NEW OPTION\r\n         |  @since  0.5.13 [0.3.0]\r\n         */\r\n        add: function(key, value, group, selected, disabled, description, rebuild){\r\n            if(key instanceof Object){\r\n                for(var k in key){\r\n                    this.add(key[k].key || k, key[k].value, key[k].group, key[k].selected, key[k].disabled, key[k].description, false);\r\n                }\r\n                return this.self.query();\r\n            }\r\n            if(this.get(key, group)){\r\n                return false;\r\n            }\r\n\r\n            // Check Group\r\n            group = (typeof(group) == \"string\")? group: \"#\";\r\n            if(group !== \"#\" && !(group in this.groups)){\r\n                var optgroup = create(\"OPTGROUP\");\r\n                optgroup.label = group;\r\n                optgroup.setAttribute(\"data-select-optgroup\", \"add\");\r\n                this.element.appendChild(optgroup);\r\n                this.items[group] = {};\r\n                this.groups[group] = optgroup;\r\n            }\r\n\r\n            // Validate Selection\r\n            if(this.self.con.multiple && this.selected.length >= this.self.con.multiLimit){\r\n                selected = false;\r\n            }\r\n            disabled = !!disabled;\r\n\r\n            // Create Option\r\n            var option = d.createElement(\"OPTION\");\r\n            option.value = key;\r\n            option.selected = selected;\r\n            option.disabled = disabled;\r\n            option.innerText = value;\r\n            option.setAttribute(\"data-select-option\", \"add\");\r\n            if(description && description.length > 0){\r\n                option.setAttribute(\"data-description\", description);\r\n            }\r\n\r\n            // Add Option and Return\r\n            ((group == \"#\")? this.element: this.groups[group]).appendChild(option);\r\n            return this.set(option, rebuild);\r\n        },\r\n\r\n        /*\r\n         |  MOVE AN EXISTING OPTION\r\n         |  @since  0.5.0 [0.5.0]\r\n         */\r\n        move: function(item, group, new_group, rebuild){\r\n            if(!(item = this.get(item, group))){ return false; }\r\n\r\n            // Create Group\r\n            if(new_group !== \"#\" && !(new_group in this.groups)){\r\n                var optgroup = create(\"OPTGROUP\");\r\n                optgroup.label = new_group;\r\n                this.element.appendChild(optgroup);\r\n                this.items[new_group] = {};\r\n                this.groups[new_group] = optgroup;\r\n                this.groups[new_group].appendChild(item.option);\r\n            }\r\n\r\n            // Move To Group\r\n            delete this.items[item.group][item.key];\r\n            item.group = new_group;\r\n            item.optgroup = this.groups[new_group] || undefined;\r\n            this.items[new_group][item.key] = item;\r\n            return (rebuild)? this.self.query(): true;\r\n        },\r\n\r\n        /*\r\n         |  REMOVE AN EXISTING OPTION\r\n         |  @since  0.5.7 [0.3.0]\r\n         */\r\n        remove: function(item, group, rebuild){\r\n            if(!(item = this.get(item, group))){ return false; }\r\n            if(item.selected){ this.unselect(item); }\r\n            if(item.disabled){ this.enable(item); }\r\n\r\n            // Remove Data\r\n            item.option.parentElement.removeChild(item.option);\r\n            var id = (/^[0-9]+$/.test(item.key))? \"_\" + item.key: item.key;\r\n            delete this.items[item.group][id];\r\n            this.length--;\r\n\r\n            // Remove Optgroup\r\n            if(Object.keys(this.items[item.group]).length === 0){\r\n                delete this.items[item.group];\r\n                delete this.groups[item.group];\r\n            }\r\n            return (rebuild)? this.self.query(): true;\r\n        },\r\n\r\n        /*\r\n         |  CHECK AN EXISTING OPTION\r\n         |  @since  0.5.0 [0.3.0]\r\n         */\r\n        is: function(state, key, group){\r\n            var state = this._r(state), item = this.get(key, group);\r\n            if(!item || [\"select\", \"unselect\", \"disable\", \"enable\"].indexOf(state) < 0){\r\n                return null;\r\n            }\r\n            if(state == \"disable\" || state == \"enable\"){\r\n                return (state == \"disable\")? item.disabled: !item.disabled;\r\n            } else if(state == \"select\" || state == \"unselect\"){\r\n                return (state == \"select\")? item.selected: !item.selected;\r\n            }\r\n            return false;\r\n        },\r\n\r\n        /*\r\n         |  INTERACT WITH AN OPTION\r\n         |  @since  0.5.3 [0.3.0]\r\n         */\r\n        handle: function(state, key, group, _force){\r\n            var item = this.get(key, group), state = this._r(state);\r\n            if(!item || [\"select\", \"unselect\", \"disable\", \"enable\"].indexOf(state) < 0){\r\n                return null;\r\n            }\r\n\r\n            // Disable || Enable\r\n            if(state == \"disable\" || state == \"enable\"){\r\n                if(!(item.option in this.disabled) && state == \"disable\"){\r\n                    this.disabled.push(item.option);\r\n                } else if((item.option in this.disabled) && state == \"enable\"){\r\n                    this.disabled.splice(this.disabled.indexOf(item.option), 1);\r\n                }\r\n                item.disabled = (state == \"disable\");\r\n                item.option.disabled = (state == \"disable\");\r\n                return this.self.callback.call(this.self, item, state);\r\n            }\r\n\r\n            // Select || Unselect\r\n            var dis = (cHAS(this.self.select, \"disabled\") || item.disabled || item.option.disabled),\r\n                lmt = (this.self.con.multiple && this.self.con.multiLimit <= this.selected.length),\r\n                sgl = (!this.self.con.multiple && this.selected.indexOf(item.option) > 0),\r\n                del = (this.self.con.multiLimit == 0 && this.self.con.deselect == true),\r\n                uns = (!this.self.con.multiple && !this.self.con.deselect && _force !== true);\r\n            if(state == \"select\"){\r\n                if(dis || lmt || del || sgl){\r\n                    return false;\r\n                }\r\n                if(!this.self.con.multiple){\r\n                    for(var i in this.selected){\r\n                        this.unselect(this.selected[i], undefined, true);\r\n                    }\r\n                }\r\n                if(this.selected.indexOf(item.option) < 0){\r\n                    this.selected.push(item.option);\r\n                }\r\n            } else if(state == \"unselect\"){\r\n                if(dis || uns){\r\n                    return false;\r\n                }\r\n                this.selected.splice(this.selected.indexOf(item.option), 1);\r\n            }\r\n            item.selected = (state == \"select\");\r\n            item.option.selected = (state == \"select\");\r\n            item.option[(state.length > 6? \"remove\": \"set\") + \"Attribute\"](\"selected\", \"selected\");\r\n            return this.self.callback.call(this.self, item, state, _force);\r\n        },\r\n        enable: function(key, group){\r\n            return this.handle(\"enable\", key, group, false);\r\n        },\r\n        disable: function(key, group){\r\n            return this.handle(\"disable\", key, group, false);\r\n        },\r\n        select: function(key, group){\r\n            return this.handle(\"select\", key, group, false);\r\n        },\r\n        unselect: function(key, group, _force){\r\n            return this.handle(\"unselect\", key, group, _force);\r\n        },\r\n        toggle: function(item, group){\r\n            if(!(item = this.get(item, group))){ return false; }\r\n            return this.handle((item.selected? \"unselect\": \"select\"), item, group, false);\r\n        },\r\n\r\n        /*\r\n         |  INVERT CURRENT <STATE>\r\n         |  @since  0.5.15 [0.3.0]\r\n         */\r\n        invert: function(state){\r\n            state = this._r(state);\r\n            if([\"enable\", \"disable\"].indexOf(state) >= 0){\r\n                var invert = this.disabled, action = (state == \"enable\")? \"disable\": \"enable\";\r\n            } else if([\"select\", \"unselect\"].indexOf(state) >= 0){\r\n                var invert = this.selected, action = (state == \"select\")? \"unselect\": \"select\";\r\n            }\r\n            var convert = Array.prototype.filter.call(this, function(element){\r\n                return !(element in invert);\r\n            }), self = this;\r\n\r\n            // Loop\r\n            [].concat(invert).forEach(function(item){\r\n                self.handle.call(self, action, item);\r\n            });\r\n            [].concat(convert).forEach(function(item){\r\n                self.handle.call(self, state, item);\r\n            });\r\n            return true;\r\n        },\r\n\r\n        /*\r\n         |  SET <STATE> ON ALL OPTIONs\r\n         |  @since  0.5.0 [0.5.0]\r\n         */\r\n        all: function(state, group){\r\n            var self = this, list = this;\r\n            if(group in this.items){\r\n                list = Object.keys(this.items[group]);\r\n            } else if([\"unselect\", \"enable\"].indexOf(state) >= 0){\r\n                list = [].concat((state == \"unselect\")? this.selected: this.disabled);\r\n            }\r\n            Array.prototype.forEach.call(list, function(item){\r\n                self.handle.call(self, state, item, group, false);\r\n            });\r\n            return true;\r\n        },\r\n\r\n        /*\r\n         |  SET <STATE> FOR A BUNCH OF OPTIONs\r\n         |  @since  0.5.4 [0.5.3]\r\n         */\r\n        walk: function(state, items, args){\r\n            if(items instanceof Array || items.length){\r\n                for(var l = items.length, i = 0; i < l; i++){\r\n                    this.handle.apply(this, [state, items[i], null].concat(args));\r\n                }\r\n            } else if(items instanceof Object){\r\n                var self = this;\r\n                if(items.forEach){\r\n                    items.forEach(function(value){\r\n                        self.handle.apply(self, [state, value, null].concat(args));\r\n                    });\r\n                } else {\r\n                    for(var key in items){\r\n                        if(typeof(items[key]) != \"string\" && typeof(items[key]) != \"number\" && !(items[key] instanceof Element)){\r\n                            continue;\r\n                        }\r\n                        this.handle.apply(this, [state, items[key], (key in this.items? key: null)]).concat(args);\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        },\r\n\r\n        /*\r\n         |  APPLY LINGUSTIC RULES\r\n         |  @since  0.5.13 [0.5.13]\r\n         */\r\n        applyLinguisticRules: function(search, casesensitive){\r\n            var rules = this.self.con.linguisticRules, values = [];\r\n            \r\n            // Prepare Rules\r\n            Object.keys(rules).forEach(function(key){ \r\n                values.push(\"(\" + key + \"|[\" + rules[key] + \"])\");\r\n            });\r\n            if(casesensitive){\r\n                values = values.concat(values.map(function(s){ return s.toUpperCase(); })); \r\n            }\r\n\r\n            return search.replace(new RegExp(values.join(\"|\"), (casesensitive)? \"g\": \"ig\"), function(m){\r\n                return values[[].indexOf.call(arguments, m, 1) - 1];\r\n            });\r\n        },\r\n    \r\n\r\n        /*\r\n         |  FIND SOME OPTIONs - ARRAY EDITION\r\n         |  @since  0.5.15 [0.3.0]\r\n         */\r\n        find: function(search, config){\r\n            var self = this, matches, has = {};\r\n            \r\n            // Get Config\r\n            if(!config){\r\n                config = this.self.con.searchConfig;\r\n            }\r\n\r\n            // Config Callback\r\n            if(typeof config === \"function\"){\r\n                matches = config.bind(this, search);\r\n            }\r\n\r\n            // Config Handler\r\n            else {\r\n                config = (config instanceof Array)? config: [config];\r\n                config.forEach(function(c){\r\n                    if(typeof(c) === \"string\"){ has[c] = true; }\r\n                });\r\n                has.any = (!has.any)? has.attributes && has.value: has.any;\r\n                \r\n                // Cleanup & Prepare\r\n                if(!has.regex || has.text){\r\n                    search = search.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n                }\r\n                if(!has.exactglyphes){\r\n                    search = this.self.options.applyLinguisticRules(search, has.case);\r\n                }\r\n                if(has.word){\r\n                    search = '\\\\b' + search + '\\\\b';\r\n                }\r\n\r\n                // Search\r\n                var regex = new RegExp(search, (!has.case)? \"mi\": \"m\"),\r\n                    sfunc = function(opt){ return regex.test(opt.text || opt.value); };\r\n                \r\n                // Handle\r\n                if(has.any){\r\n                    matches = function(opt){ return sfunc(opt) || [].some.call(opt.attributes, sfunc); };\r\n                } else if(has.attributes){\r\n                    matches = function(opt){ return [].some.call(opt.attributes, sfunc); };\r\n                } else {\r\n                    matches = sfunc;\r\n                }\r\n\r\n                if(!this.self.con.searchDisabled){\r\n                    var temp = matches;\r\n                    matches = function(opt){ return !opt.disabled && temp(opt); };\r\n                }\r\n            }\r\n\r\n            // Hammer Time\r\n            return [].filter.call(this.self.e.options, matches).map(function(opt){\r\n                return opt.hidden? false: self.get(opt) \r\n            });\r\n        },\r\n\r\n        /*\r\n         |  FIND SOME OPTIONs - WALKER EDITION\r\n         |  @since  0.5.5 [0.3.0]\r\n         */\r\n        finder: function(search, config){\r\n            if(this._finderLoop === undefined){\r\n                this._finderLoop = this.find(search, config);\r\n            }\r\n            var item;\r\n            while((item = this._finderLoop.shift()) !== undefined){\r\n                return item;\r\n            }\r\n            delete this._finderLoop;\r\n            return false;\r\n        },\r\n\r\n        /*\r\n         |  NEW OPTIONS WALKER\r\n         |  @since  0.5.15 [0.4.0]\r\n         */\r\n        walker: function(orderi, orderg){\r\n            if(typeof(this._inLoop) != \"undefined\" && this._inLoop){\r\n                if(this._inItems.length > 0){\r\n                    do {\r\n                        var temp = this.items[this._inGroup][this._inItems.shift()];\r\n                    } while(temp.hidden === true);\r\n                    return temp;\r\n                }\r\n\r\n                // Sort Items\r\n                if(this._inGroups.length > 0){\r\n                    while(this._inGroups.length > 0){\r\n                        var group = this._inGroups.shift();\r\n                        if(!(group in this.items)){\r\n                            return false;\r\n                        }\r\n\r\n                        var keys = Object.keys(this.items[group]);\r\n                        if(keys.length > 0){\r\n                            break;\r\n                        }\r\n                    }\r\n                    if(orderi == \"ASC\"){\r\n                        keys.sort();\r\n                    } else if(orderi == \"DESC\"){\r\n                        keys.sort().reverse();\r\n                    } else if(typeof(orderi) == \"function\"){\r\n                        keys = orderi.call(this, keys);\r\n                    }\r\n                    this._inItems = keys;\r\n                    this._inGroup = group;\r\n                    return this.walker(null, null);\r\n                }\r\n\r\n                // Delete and Exit\r\n                delete this._inLoop;\r\n                delete this._inItems;\r\n                delete this._inGroup;\r\n                delete this._inGroups;\r\n                return false;\r\n            }\r\n\r\n            // Sort Groups\r\n            var groups = Object.keys(this.groups) || [];\r\n            if(orderg == \"ASC\"){\r\n                groups.sort();\r\n            } else if(orderg == \"DESC\"){\r\n                groups.sort().reverse();\r\n            } else if(typeof(orderg) == \"function\"){\r\n                groups = orderg.call(this, groups);\r\n            }\r\n            groups.unshift(\"#\");\r\n\r\n            // Init Loop\r\n            this._inLoop = true;\r\n            this._inItems = [];\r\n            this._inGroups = groups;\r\n            return this.walker(orderi, null);\r\n        }\r\n    };\r\n\r\n    // Return\r\n    return select;\r\n}));\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvdGFpbC5zZWxlY3QvanMvdGFpbC5zZWxlY3QuanM/NzNhZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxPQUFPLElBQTBDO0FBQ2pELFFBQVEsbUNBQU8sV0FBVyxzQkFBc0IsRUFBRTtBQUFBLG9HQUFDO0FBQ25ELEtBQUssTUFBTSxFQXFCTjtBQUNMLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGdCQUFnQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsT0FBTztBQUN6RCwwREFBMEQ7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLG1DQUFtQztBQUNoRjtBQUNBOztBQUVBO0FBQ0E7QUFDQSx5REFBeUQ7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7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QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsZUFBZTtBQUM5RCxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBLHNEQUFzRDtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMENBQTBDLDBDQUEwQzs7QUFFcEY7QUFDQTtBQUNBLDRDQUE0QywwREFBMEQ7QUFDdEcsaUJBQWlCO0FBQ2pCLDRDQUE0Qyw0Q0FBNEM7QUFDeEYsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDRDQUE0QyxtQ0FBbUM7QUFDL0U7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxDQUFDIiwiZmlsZSI6Ii4vbm9kZV9tb2R1bGVzL3RhaWwuc2VsZWN0L2pzL3RhaWwuc2VsZWN0LmpzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuIHwgIHRhaWwuc2VsZWN0IC0gVGhlIHZhbmlsbGEgc29sdXRpb24gdG8gbWFrZSB5b3VyIEhUTUwgc2VsZWN0IGZpZWxkcyBBV0VTT01FIVxyXG4gfCAgQGZpbGUgICAgICAgLi9qcy90YWlsLnNlbGVjdC5qc1xyXG4gfCAgQGF1dGhvciAgICAgU2FtQnJpc2hlcyA8c2FtQHB5dGVzLm5ldD5cclxuIHwgIEB2ZXJzaW9uICAgIDAuNS4xNSAtIEJldGFcclxuIHxcclxuIHwgIEB3ZWJzaXRlICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9weXRlc05FVC90YWlsLnNlbGVjdFxyXG4gfCAgQGxpY2Vuc2UgICAgWDExIC8gTUlUIExpY2Vuc2VcclxuIHwgIEBjb3B5cmlnaHQgIENvcHlyaWdodCDCqSAyMDE0IC0gMjAxOSBTYW1CcmlzaGVzLCBweXRlc05FVCA8aW5mb0BweXRlcy5uZXQ+XHJcbiAqL1xyXG47KGZ1bmN0aW9uKHJvb3QsIGZhY3Rvcnkpe1xyXG4gICAgaWYodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpe1xyXG4gICAgICAgIGRlZmluZShmdW5jdGlvbigpeyByZXR1cm4gZmFjdG9yeShyb290KTsgfSk7XHJcbiAgICB9IGVsc2UgaWYodHlwZW9mIG1vZHVsZSA9PT0gXCJvYmplY3RcIiAmJiBtb2R1bGUuZXhwb3J0cyl7XHJcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJvb3QpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBpZih0eXBlb2Ygcm9vdC50YWlsID09PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICAgICAgcm9vdC50YWlsID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJvb3QudGFpbC5zZWxlY3QgPSBmYWN0b3J5KHJvb3QpO1xyXG5cclxuICAgICAgICAvLyBqUXVlcnkgU3VwcG9ydFxyXG4gICAgICAgIGlmKHR5cGVvZiBqUXVlcnkgIT09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgICAgICBqUXVlcnkuZm4udGFpbHNlbGVjdCA9IGZ1bmN0aW9uKG8pe1xyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSBbXSwgaTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpeyBpZigoaSA9IHRhaWwuc2VsZWN0KHRoaXMsIG8pKSAhPT0gZmFsc2UpeyByLnB1c2goaSk7IH0gfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHIubGVuZ3RoID09PSAxKT8gclswXTogKHIubGVuZ3RoID09PSAwKT8gZmFsc2U6IHI7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBNb29Ub29scyBTdXBwb3J0XHJcbiAgICAgICAgaWYodHlwZW9mKE1vb1Rvb2xzKSAhPSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICAgICAgRWxlbWVudC5pbXBsZW1lbnQoeyB0YWlsc2VsZWN0OiBmdW5jdGlvbihvKXsgcmV0dXJuIG5ldyB0YWlsLnNlbGVjdCh0aGlzLCBvKTsgfSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0od2luZG93LCBmdW5jdGlvbihyb290KXtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIHcgPSByb290LCBkID0gcm9vdC5kb2N1bWVudDtcclxuXHJcbiAgICAvLyBJbnRlcm5hbCBIZWxwZXIgTWV0aG9kc1xyXG4gICAgZnVuY3Rpb24gY0hBUyhlbCwgbmFtZSl7XHJcbiAgICAgICAgcmV0dXJuIChlbCAmJiBcImNsYXNzTGlzdFwiIGluIGVsKT8gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpOiBmYWxzZTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNBREQoZWwsIG5hbWUpe1xyXG4gICAgICAgIHJldHVybiAoZWwgJiYgXCJjbGFzc0xpc3RcIiBpbiBlbCk/IGVsLmNsYXNzTGlzdC5hZGQobmFtZSk6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNSRU0oZWwsIG5hbWUpe1xyXG4gICAgICAgIHJldHVybiAoZWwgJiYgXCJjbGFzc0xpc3RcIiBpbiBlbCk/IGVsLmNsYXNzTGlzdC5yZW1vdmUobmFtZSk6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHRyaWdnZXIoZWwsIGV2ZW50LCBvcHQpe1xyXG4gICAgICAgIGlmKEN1c3RvbUV2ZW50ICYmIEN1c3RvbUV2ZW50Lm5hbWUpe1xyXG4gICAgICAgICAgICB2YXIgZXYgPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnQsIG9wdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGV2ID0gZC5jcmVhdGVFdmVudChcIkN1c3RvbUV2ZW50XCIpO1xyXG4gICAgICAgICAgICBldi5pbml0Q3VzdG9tRXZlbnQoZXZlbnQsICEhb3B0LmJ1YmJsZXMsICEhb3B0LmNhbmNlbGFibGUsIG9wdC5kZXRhaWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZWwuZGlzcGF0Y2hFdmVudChldik7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjbG9uZShvYmosIHJlcCl7XHJcbiAgICAgICAgaWYodHlwZW9mIE9iamVjdC5hc3NpZ24gPT09IFwiZnVuY3Rpb25cIil7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBvYmosIHJlcCB8fCB7fSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjbG9uZSA9IE9iamVjdC5jb25zdHJ1Y3RvcigpO1xyXG4gICAgICAgIGZvcih2YXIga2V5IGluIG9iail7XHJcbiAgICAgICAgICAgIGNsb25lW2tleV0gPSAoa2V5IGluIHJlcCk/IHJlcFtrZXldOiBvYmpba2V5XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNsb25lO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gY3JlYXRlKHRhZywgY2xhc3Nlcyl7XHJcbiAgICAgICAgdmFyIHIgPSBkLmNyZWF0ZUVsZW1lbnQodGFnKTtcclxuICAgICAgICAgICAgci5jbGFzc05hbWUgPSAoY2xhc3NlcyAmJiBjbGFzc2VzLmpvaW4pPyBjbGFzc2VzLmpvaW4oXCIgXCIpOiBjbGFzc2VzIHx8IFwiXCI7XHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcblxyXG4gICAgLypcclxuICAgICB8ICBTRUxFQ1QgQ09OU1RSVUNUT1JcclxuICAgICB8ICBAc2luY2UgIDAuNS4xMiBbMC4zLjBdXHJcbiAgICAgKi9cclxuICAgIHZhciBzZWxlY3QgPSBmdW5jdGlvbihlbCwgY29uZmlnKXtcclxuICAgICAgICBlbCA9ICh0eXBlb2YoZWwpID09IFwic3RyaW5nXCIpPyBkLnF1ZXJ5U2VsZWN0b3JBbGwoZWwpOiBlbDtcclxuICAgICAgICBpZihlbCBpbnN0YW5jZW9mIE5vZGVMaXN0IHx8IGVsIGluc3RhbmNlb2YgSFRNTENvbGxlY3Rpb24gfHwgZWwgaW5zdGFuY2VvZiBBcnJheSl7XHJcbiAgICAgICAgICAgIGZvcih2YXIgX3IgPSBbXSwgbCA9IGVsLmxlbmd0aCwgaSA9IDA7IGkgPCBsOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgX3IucHVzaChuZXcgc2VsZWN0KGVsW2ldLCBjbG9uZShjb25maWcsIHt9KSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAoX3IubGVuZ3RoID09PSAxKT8gX3JbMF06ICgoX3IubGVuZ3RoID09PSAwKT8gZmFsc2U6IF9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIShlbCBpbnN0YW5jZW9mIEVsZW1lbnQpIHx8ICEodGhpcyBpbnN0YW5jZW9mIHNlbGVjdCkpe1xyXG4gICAgICAgICAgICByZXR1cm4gIShlbCBpbnN0YW5jZW9mIEVsZW1lbnQpPyBmYWxzZTogbmV3IHNlbGVjdChlbCwgY29uZmlnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIEVsZW1lbnRcclxuICAgICAgICBpZihzZWxlY3QuaW5zdFtlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXRhaWwtc2VsZWN0XCIpXSl7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWxlY3QuaW5zdFtlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXRhaWwtc2VsZWN0XCIpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3RcIikpe1xyXG4gICAgICAgICAgICB2YXIgdGVzdCA9IEpTT04ucGFyc2UoZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3RcIikucmVwbGFjZSgvXFwnL2csICdcIicpKTtcclxuICAgICAgICAgICAgaWYodGVzdCBpbnN0YW5jZW9mIE9iamVjdCl7XHJcbiAgICAgICAgICAgICAgICBjb25maWcgPSBjbG9uZShjb25maWcsIHRlc3QpOyAvLyBUaGlzIGlzIGEgdW5vZmZpY2lhbCBmdW5jdGlvbiA7M1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZXQgRWxlbWVudCBPcHRpb25zXHJcbiAgICAgICAgdmFyIHBsYWNlaG9sZGVyID0gZWwuZ2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIikgfHwgZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1wbGFjZWhvbGRlclwiKSxcclxuICAgICAgICAgICAgZmIxID0gXCJiaW5kU291cmNlU2VsZWN0XCIsIGZiMiA9IFwic291cmNlSGlkZVwiOyAvLyBGYWxsYmFja3NcclxuICAgICAgICBjb25maWcgPSAodHlwZW9mKGNvbmZpZykgPT0gXCJvYmplY3RcIik/IGNvbmZpZzoge307XHJcbiAgICAgICAgY29uZmlnLm11bHRpcGxlID0gKFwibXVsdGlwbGVcIiBpbiBjb25maWcpPyBjb25maWcubXVsdGlwbGU6IGVsLm11bHRpcGxlO1xyXG4gICAgICAgIGNvbmZpZy5kaXNhYmxlZCA9IChcImRpc2FibGVkXCIgaW4gY29uZmlnKT8gY29uZmlnLmRpc2FibGVkOiBlbC5kaXNhYmxlZDtcclxuICAgICAgICBjb25maWcucGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlciB8fCBjb25maWcucGxhY2Vob2xkZXIgfHwgbnVsbDtcclxuICAgICAgICBjb25maWcud2lkdGggPSAoY29uZmlnLndpZHRoID09PSBcImF1dG9cIik/IGVsLm9mZnNldFdpZHRoICsgNTA6IGNvbmZpZy53aWR0aDtcclxuICAgICAgICBjb25maWcuc291cmNlQmluZCA9IChmYjEgaW4gY29uZmlnKT8gY29uZmlnW2ZiMV06IGNvbmZpZy5zb3VyY2VCaW5kIHx8IGZhbHNlO1xyXG4gICAgICAgIGNvbmZpZy5zb3VyY2VIaWRlID0gKGZiMiBpbiBjb25maWcpPyBjb25maWdbZmIyXTogY29uZmlnLnNvdXJjZUhpZGUgfHwgdHJ1ZTtcclxuICAgICAgICBjb25maWcubXVsdGlMaW1pdCA9IChjb25maWcubXVsdGlMaW1pdCA+PSAwKT8gY29uZmlnLm11bHRpTGltaXQ6IEluZmluaXR5O1xyXG5cclxuICAgICAgICAvLyBJbml0IEluc3RhbmNlXHJcbiAgICAgICAgdGhpcy5lID0gZWw7XHJcbiAgICAgICAgdGhpcy5pZCA9ICsrc2VsZWN0LmNvdW50O1xyXG4gICAgICAgIHRoaXMuY29uID0gY2xvbmUoc2VsZWN0LmRlZmF1bHRzLCBjb25maWcpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRzID0ge307XHJcbiAgICAgICAgc2VsZWN0Lmluc3RbXCJ0YWlsLVwiICsgdGhpcy5pZF0gPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluaXQoKS5iaW5kKCk7XHJcbiAgICB9LCBvcHRpb25zO1xyXG4gICAgc2VsZWN0LnZlcnNpb24gPSBcIjAuNS4xNVwiO1xyXG4gICAgc2VsZWN0LnN0YXR1cyA9IFwiYmV0YVwiO1xyXG4gICAgc2VsZWN0LmNvdW50ID0gMDtcclxuICAgIHNlbGVjdC5pbnN0ID0ge307XHJcblxyXG4gICAgLypcclxuICAgICB8ICBTVE9SQUdFIDo6IERFRkFVTFQgT1BUSU9OU1xyXG4gICAgICovXHJcbiAgICBzZWxlY3QuZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgYW5pbWF0ZTogdHJ1ZSwgICAgICAgICAgICAgIC8vIFswLjMuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgY2xhc3NOYW1lczogbnVsbCwgICAgICAgICAgIC8vIFswLjIuMF0gICAgICBCb29sZWFuLCBTdHJpbmcsIEFycmF5LCBudWxsXHJcbiAgICAgICAgY3N2T3V0cHV0OiBmYWxzZSwgICAgICAgICAgIC8vIFswLjMuNF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgY3N2U2VwYXJhdG9yOiBcIixcIiwgICAgICAgICAgLy8gWzAuMy40XSAgICAgIFN0cmluZ1xyXG4gICAgICAgIGRlc2NyaXB0aW9uczogZmFsc2UsICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIGRlc2VsZWN0OiBmYWxzZSwgICAgICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIGRpc2FibGVkOiBmYWxzZSwgICAgICAgICAgICAvLyBbMC41LjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIGhlaWdodDogMzUwLCAgICAgICAgICAgICAgICAvLyBbMC4yLjBdICAgICAgSW50ZWdlciwgbnVsbFxyXG4gICAgICAgIGhpZGVEaXNhYmxlZDogZmFsc2UsICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIGhpZGVTZWxlY3RlZDogZmFsc2UsICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIGl0ZW1zOiB7fSwgICAgICAgICAgICAgICAgICAvLyBbMC4zLjBdICAgICAgT2JqZWN0XHJcbiAgICAgICAgbG9jYWxlOiBcImVuXCIsICAgICAgICAgICAgICAgLy8gWzAuNS4wXSAgICAgIFN0cmluZ1xyXG4gICAgICAgIGxpbmd1aXN0aWNSdWxlczogeyAgICAgICAgICAvLyBbMC41LjldICAgICAgT2JqZWN0XHJcbiAgICAgICAgICAgIFwi0LVcIjogXCLRkVwiLFxyXG4gICAgICAgICAgICBcImFcIjogXCLDpFwiLFxyXG4gICAgICAgICAgICBcIm9cIjogXCLDtlwiLFxyXG4gICAgICAgICAgICBcInVcIjogXCLDvFwiLFxyXG4gICAgICAgICAgICBcInNzXCI6IFwiw59cIlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbXVsdGlwbGU6IGZhbHNlLCAgICAgICAgICAgIC8vIFswLjIuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgbXVsdGlMaW1pdDogSW5maW5pdHksICAgICAgIC8vIFswLjMuMF0gICAgICBJbnRlZ2VyLCBJbmZpbml0eVxyXG4gICAgICAgIG11bHRpUGluU2VsZWN0ZWQ6IGZhbHNlLCAgICAvLyBbMC41LjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIG11bHRpQ29udGFpbmVyOiBmYWxzZSwgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhbiwgU3RyaW5nXHJcbiAgICAgICAgbXVsdGlTaG93Q291bnQ6IHRydWUsICAgICAgIC8vIFswLjMuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgbXVsdGlTaG93TGltaXQ6IGZhbHNlLCAgICAgIC8vIFswLjUuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgbXVsdGlTZWxlY3RBbGw6IGZhbHNlLCAgICAgIC8vIFswLjQuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgbXVsdGlTZWxlY3RHcm91cDogdHJ1ZSwgICAgIC8vIFswLjQuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgb3BlbkFib3ZlOiBudWxsLCAgICAgICAgICAgIC8vIFswLjMuMF0gICAgICBCb29sZWFuLCBudWxsXHJcbiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwsICAgICAgICAgIC8vIFswLjIuMF0gICAgICBTdHJpbmcsIG51bGxcclxuICAgICAgICBzZWFyY2g6IGZhbHNlLCAgICAgICAgICAgICAgLy8gWzAuMy4wXSAgICAgIEJvb2xlYW5cclxuICAgICAgICBzZWFyY2hDb25maWc6IFsgICAgICAgICAgICAgLy8gWzAuNS4xM10gICAgIEFycmF5XHJcbiAgICAgICAgICAgIFwidGV4dFwiLCBcInZhbHVlXCJcclxuICAgICAgICBdLFxyXG4gICAgICAgIHNlYXJjaEZvY3VzOiB0cnVlLCAgICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIHNlYXJjaE1hcmtlZDogdHJ1ZSwgICAgICAgICAvLyBbMC4zLjBdICAgICAgQm9vbGVhblxyXG4gICAgICAgIHNlYXJjaE1pbkxlbmd0aDogMSwgICAgICAgICAvLyBbMC41LjEzXSAgICAgSW50ZWdlclxyXG4gICAgICAgIHNlYXJjaERpc2FibGVkOiB0cnVlLCAgICAgICAvLyBbMC41LjVdICAgICAgQm9vbGVhblxyXG4gICAgICAgIHNvcnRJdGVtczogZmFsc2UsICAgICAgICAgICAvLyBbMC4zLjBdICAgICAgU3RyaW5nLCBGdW5jdGlvbiwgZmFsc2VcclxuICAgICAgICBzb3J0R3JvdXBzOiBmYWxzZSwgICAgICAgICAgLy8gWzAuMy4wXSAgICAgIFN0cmluZywgRnVuY3Rpb24sIGZhbHNlXHJcbiAgICAgICAgc291cmNlQmluZDogZmFsc2UsICAgICAgICAgIC8vIFswLjUuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgc291cmNlSGlkZTogdHJ1ZSwgICAgICAgICAgIC8vIFswLjUuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgc3RhcnRPcGVuOiBmYWxzZSwgICAgICAgICAgIC8vIFswLjMuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgc3RheU9wZW46IGZhbHNlLCAgICAgICAgICAgIC8vIFswLjMuMF0gICAgICBCb29sZWFuXHJcbiAgICAgICAgd2lkdGg6IG51bGwsICAgICAgICAgICAgICAgIC8vIFswLjIuMF0gICAgICBJbnRlZ2VyLCBTdHJpbmcsIG51bGxcclxuICAgICAgICBjYkNvbXBsZXRlOiB1bmRlZmluZWQsICAgICAgLy8gWzAuNS4wXSAgICAgIEZ1bmN0aW9uXHJcbiAgICAgICAgY2JFbXB0eTogdW5kZWZpbmVkLCAgICAgICAgIC8vIFswLjUuMF0gICAgICBGdW5jdGlvblxyXG4gICAgICAgIGNiTG9vcEl0ZW06IHVuZGVmaW5lZCwgICAgICAvLyBbMC40LjBdICAgICAgRnVuY3Rpb25cclxuICAgICAgICBjYkxvb3BHcm91cDogdW5kZWZpbmVkICAgICAgLy8gWzAuNC4wXSAgICAgIEZ1bmN0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgfCAgU1RPUkFHRSA6OiBTVFJJTkdTXHJcbiAgICAgKi9cclxuICAgIHNlbGVjdC5zdHJpbmdzID0ge1xyXG4gICAgICAgIGVuOiB7XHJcbiAgICAgICAgICAgIGFsbDogXCJBbGxcIixcclxuICAgICAgICAgICAgbm9uZTogXCJOb25lXCIsXHJcbiAgICAgICAgICAgIGVtcHR5OiBcIk5vIE9wdGlvbnMgYXZhaWxhYmxlXCIsXHJcbiAgICAgICAgICAgIGVtcHR5U2VhcmNoOiBcIk5vIE9wdGlvbnMgZm91bmRcIixcclxuICAgICAgICAgICAgbGltaXQ6IFwiWW91IGNhbid0IHNlbGVjdCBtb3JlIE9wdGlvbnNcIixcclxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiU2VsZWN0IGFuIE9wdGlvbi4uLlwiLFxyXG4gICAgICAgICAgICBwbGFjZWhvbGRlck11bHRpOiBcIlNlbGVjdCB1cCB0byA6bGltaXQgT3B0aW9ucy4uLlwiLFxyXG4gICAgICAgICAgICBzZWFyY2g6IFwiVHlwZSBpbiB0byBzZWFyY2guLi5cIixcclxuICAgICAgICAgICAgZGlzYWJsZWQ6IFwiVGhpcyBGaWVsZCBpcyBkaXNhYmxlZFwiXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb2RpZnk6IGZ1bmN0aW9uKGxvY2FsZSwgaWQsIHN0cmluZyl7XHJcbiAgICAgICAgICAgIGlmKCEobG9jYWxlIGluIHRoaXMpKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigoaWQgaW5zdGFuY2VvZiBPYmplY3QpKXtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGlkKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGlmeShsb2NhbGUsIGtleSwgaWRba2V5XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzW2xvY2FsZV1baWRdID0gKHR5cGVvZihzdHJpbmcpID09IFwic3RyaW5nXCIpPyBzdHJpbmc6IHRoaXNbbG9jYWxlXVtpZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWdpc3RlcjogZnVuY3Rpb24obG9jYWxlLCBvYmplY3Qpe1xyXG4gICAgICAgICAgICBpZih0eXBlb2YobG9jYWxlKSAhPSBcInN0cmluZ1wiIHx8ICEob2JqZWN0IGluc3RhbmNlb2YgT2JqZWN0KSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpc1tsb2NhbGVdID0gb2JqZWN0O1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgfCAgVEFJTC5TRUxFQ1QgSEFORExFUlxyXG4gICAgICovXHJcbiAgICBzZWxlY3QucHJvdG90eXBlID0ge1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIElORVJOQUwgOjogVFJBTlNMQVRFXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjggWzAuNS44XVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF9lOiBmdW5jdGlvbihzdHJpbmcsIHJlcGxhY2UsIGRlZil7XHJcbiAgICAgICAgICAgIGlmKCEoc3RyaW5nIGluIHRoaXMuX18pKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoIWRlZik/IHN0cmluZzogZGVmO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RyaW5nID0gdGhpcy5fX1tzdHJpbmddO1xyXG4gICAgICAgICAgICBpZih0eXBlb2Yoc3RyaW5nKSA9PT0gXCJmdW5jdGlvblwiKXtcclxuICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5jYWxsKHRoaXMsIHJlcGxhY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZihyZXBsYWNlKSA9PT0gXCJvYmplY3RcIil7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGtleSBpbiByZXBsYWNlKXtcclxuICAgICAgICAgICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShrZXksIHJlcGxhY2Vba2V5XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHN0cmluZztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBJTlRFUk5BTCA6OiBJTklUIFNFTEVDVCBGSUVMRFxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4xMyBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBjbGFzc2VzID0gW1widGFpbC1zZWxlY3RcIl0sIGNvbiA9IHRoaXMuY29uLFxyXG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL15bMC05Ll0rKD86Y218bW18aW58cHh8cHR8cGN8ZW18ZXh8Y2h8cmVtfHZ3fHZofHZtaW58dm1heHxcXCUpJC9pO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5pdCBDbGFzc05hbWVzXHJcbiAgICAgICAgICAgIHZhciBjID0gKGNvbi5jbGFzc05hbWVzID09PSB0cnVlKT8gdGhpcy5lLmNsYXNzTmFtZTogY29uLmNsYXNzTmFtZXM7XHJcbiAgICAgICAgICAgIGNsYXNzZXMucHVzaCgoYyAmJiBjLnB1c2gpPyBjLmpvaW4oXCIgXCIpOiAoYyAmJiBjLnNwbGl0KT8gYzogXCJuby1jbGFzc2VzXCIpO1xyXG4gICAgICAgICAgICBpZihjb24uaGlkZVNlbGVjdGVkKXsgICAgY2xhc3Nlcy5wdXNoKFwiaGlkZS1zZWxlY3RlZFwiKTsgfVxyXG4gICAgICAgICAgICBpZihjb24uaGlkZURpc2FibGVkKXsgICAgY2xhc3Nlcy5wdXNoKFwiaGlkZS1kaXNhYmxlZFwiKTsgfVxyXG4gICAgICAgICAgICBpZihjb24ubXVsdGlMaW1pdCA9PSAwKXsgY2xhc3Nlcy5wdXNoKFwiZGlzYWJsZWRcIik7ICAgICAgfVxyXG4gICAgICAgICAgICBpZihjb24ubXVsdGlwbGUpeyAgICAgICAgY2xhc3Nlcy5wdXNoKFwibXVsdGlwbGVcIik7ICAgICAgfVxyXG4gICAgICAgICAgICBpZihjb24uZGVzZWxlY3QpeyAgICAgICAgY2xhc3Nlcy5wdXNoKFwiZGVzZWxlY3RcIik7ICAgICAgfVxyXG4gICAgICAgICAgICBpZihjb24uZGlzYWJsZWQpeyAgICAgICAgY2xhc3Nlcy5wdXNoKFwiZGlzYWJsZWRcIik7ICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSW5pdCBWYXJpYWJsZXNcclxuICAgICAgICAgICAgdGhpcy5fXyA9IGNsb25lKHNlbGVjdC5zdHJpbmdzLmVuLCBzZWxlY3Quc3RyaW5nc1tjb24ubG9jYWxlXSB8fCB7fSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2luaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLl9xdWVyeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdCA9IGNyZWF0ZShcIkRJVlwiLCBjbGFzc2VzKTtcclxuICAgICAgICAgICAgdGhpcy5sYWJlbCA9IGNyZWF0ZShcIkRJVlwiLCBcInNlbGVjdC1sYWJlbFwiKTtcclxuICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IGNyZWF0ZShcIkRJVlwiLCBcInNlbGVjdC1kcm9wZG93blwiKTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2ggPSBjcmVhdGUoXCJESVZcIiwgXCJkcm9wZG93bi1zZWFyY2hcIik7XHJcbiAgICAgICAgICAgIHRoaXMuY3N2SW5wdXQgPSBjcmVhdGUoXCJJTlBVVFwiLCBcInNlbGVjdC1zZWFyY2hcIik7XHJcblxyXG4gICAgICAgICAgICAvLyBCdWlsZCA6OiBTZWxlY3RcclxuICAgICAgICAgICAgaWYodGhpcy5lLmdldEF0dHJpYnV0ZShcInRhYmluZGV4XCIpICE9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIHRoaXMuZS5nZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihjb24ud2lkdGggJiYgcmVnZXhwLnRlc3QoY29uLndpZHRoKSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zdHlsZS53aWR0aCA9IGNvbi53aWR0aDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKGNvbi53aWR0aCAmJiAhaXNOYU4ocGFyc2VGbG9hdChjb24ud2lkdGgsIDEwKSkpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Quc3R5bGUud2lkdGggPSBjb24ud2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIDo6IExhYmVsXHJcbiAgICAgICAgICAgIHRoaXMubGFiZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlLmNhbGwoc2VsZiwgc2VsZi5jb24uYW5pbWF0ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdC5hcHBlbmRDaGlsZCh0aGlzLmxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIDo6IERyb3Bkb3duXHJcbiAgICAgICAgICAgIGlmKCFpc05hTihwYXJzZUludChjb24uaGVpZ2h0LCAxMCkpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc3R5bGUubWF4SGVpZ2h0ID0gcGFyc2VJbnQoY29uLmhlaWdodCwgMTApICsgXCJweFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGNvbi5zZWFyY2gpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2guaW5uZXJIVE1MID0gJzxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwic2VhcmNoLWlucHV0XCIgLz4nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2guY2hpbGRyZW5bMF0ucGxhY2Vob2xkZXIgPSB0aGlzLl9lKFwic2VhcmNoXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2guY2hpbGRyZW5bMF0uYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnF1ZXJ5LmNhbGwoc2VsZiwgKHRoaXMudmFsdWUubGVuZ3RoID4gY29uLnNlYXJjaE1pbkxlbmd0aCk/IHRoaXMudmFsdWU6IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXBwZW5kQ2hpbGQodGhpcy5zZWFyY2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKHRoaXMuZHJvcGRvd24pO1xyXG5cclxuICAgICAgICAgICAgLy8gQnVpbGQgOjogQ1NWIElucHV0XHJcbiAgICAgICAgICAgIHRoaXMuY3N2SW5wdXQudHlwZSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgIGlmKGNvbi5jc3ZPdXRwdXQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jc3ZJbnB1dC5uYW1lID0gdGhpcy5lLm5hbWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmUucmVtb3ZlQXR0cmlidXRlKFwibmFtZVwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKHRoaXMuY3N2SW5wdXQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQcmVwYXJlIENvbnRhaW5lclxyXG4gICAgICAgICAgICBpZihjb24ubXVsdGlwbGUgJiYgY29uLm11bHRpQ29udGFpbmVyKXtcclxuICAgICAgICAgICAgICAgIGlmKGQucXVlcnlTZWxlY3Rvcihjb24ubXVsdGlDb250YWluZXIpKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGQucXVlcnlTZWxlY3Rvcihjb24ubXVsdGlDb250YWluZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSArPSBcIiB0YWlsLXNlbGVjdC1jb250YWluZXJcIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihjb24ubXVsdGlDb250YWluZXIgPT09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgKz0gXCIgdGFpbC1zZWxlY3QtY29udGFpbmVyXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFByZXBhcmUgT3B0aW9uc1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBuZXcgb3B0aW9ucyh0aGlzLmUsIHRoaXMpO1xyXG4gICAgICAgICAgICBmb3IodmFyIGwgPSB0aGlzLmUub3B0aW9ucy5sZW5ndGgsIGkgPSAwOyBpIDwgbDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zZXQodGhpcy5lLm9wdGlvbnNbaV0sIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IodmFyIGtleSBpbiBjb24uaXRlbXMpe1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvbi5pdGVtc1trZXldKSA9PSBcInN0cmluZ1wiKXtcclxuICAgICAgICAgICAgICAgICAgICBjb24uaXRlbXNba2V5XSA9IHt2YWx1ZTogY29uLml0ZW1zW2tleV19O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmFkZChjb24uaXRlbXNba2V5XS5rZXkgfHwga2V5LCBjb24uaXRlbXNba2V5XS52YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb24uaXRlbXNba2V5XS5ncm91cCwgY29uLml0ZW1zW2tleV0uc2VsZWN0ZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uLml0ZW1zW2tleV0uZGlzYWJsZWQsIGNvbi5pdGVtc1trZXldLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBBcHBlbmQgYW5kIFJldHVyblxyXG4gICAgICAgICAgICBpZih0aGlzLmUubmV4dEVsZW1lbnRTaWJsaW5nKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZS5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZSh0aGlzLnNlbGVjdCwgdGhpcy5lLm5leHRFbGVtZW50U2libGluZyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmUucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnNlbGVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoY29uLnNvdXJjZUhpZGUpe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5lLnN0eWxlLmRpc3BsYXkgPT0gXCJub25lXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmUuc2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3QtaGlkZGVuXCIsIFwiZGlzcGxheVwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLmUuc3R5bGUudmlzaWJpbGl0eSA9PSBcImhpZGRlblwiKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zdHlsZS52aXNpYmlsdGl5ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmUuc2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3QtaGlkZGVuXCIsIFwidmlzaWJpbGl0eVwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmUuc2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3QtaGlkZGVuXCIsIFwiMFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmUuc2V0QXR0cmlidXRlKFwiZGF0YS10YWlsLXNlbGVjdFwiLCBcInRhaWwtXCIgKyB0aGlzLmlkKTtcclxuICAgICAgICAgICAgaWYoc2VsZi5jb24uc3RhcnRPcGVuKXtcclxuICAgICAgICAgICAgICAgIHRoaXMub3Blbihjb24uYW5pbWF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKGNvbi5jYkNvbXBsZXRlIHx8IGZ1bmN0aW9uKCl7IH0pLmNhbGwodGhpcywgdGhpcy5zZWxlY3QpO1xyXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMuX2luaXQgPSBmYWxzZSk/IHRoaXM6IHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgSU5URVJOQUwgOjogRVZFTlQgTElTVEVORVJcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTMgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGJpbmQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIC8vIEtleXMgTGlzdGVuZXJcclxuICAgICAgICAgICAgZC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2gpLCBvcHQsIGlubmVyLCBlLCB0ZW1wLCB0bXA7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BhY2UgPSAoa2V5ID09IDMyICYmIHNlbGYuc2VsZWN0ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGlmKCFzcGFjZSAmJiAoIWNIQVMoc2VsZi5zZWxlY3QsIFwiYWN0aXZlXCIpIHx8IFsxMywgMjcsIDM4LCA0MF0uaW5kZXhPZihrZXkpIDwgMCkpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTcGFjZVxyXG4gICAgICAgICAgICAgICAgaWYoa2V5ID09PSAzMil7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYub3BlbihzZWxmLmNvbi5hbmltYXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBFbnRlciB8fCBFc2NhcGVcclxuICAgICAgICAgICAgICAgIGlmKGtleSA9PSAxMyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoKG9wdCA9IHNlbGYuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93bi1vcHRpb24uaG92ZXI6bm90KC5kaXNhYmxlZClcIikpKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLnNlbGVjdC5jYWxsKHNlbGYub3B0aW9ucywgb3B0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihrZXkgPT0gMjcgfHwga2V5ID09IDEzKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jbG9zZShzZWxmLmNvbi5hbmltYXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUb3AgfHwgRG93blxyXG4gICAgICAgICAgICAgICAgaWYoKG9wdCA9IHNlbGYuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93bi1vcHRpb24uaG92ZXI6bm90KC5kaXNhYmxlZClcIikpKXtcclxuICAgICAgICAgICAgICAgICAgICBjUkVNKG9wdCwgXCJob3ZlclwiKTsgZSA9IFsoKGtleSA9PSA0MCk/IFwibmV4dFwiOiBcInByZXZpb3VzXCIpICsgXCJFbGVtZW50U2libGluZ1wiXTtcclxuICAgICAgICAgICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCh0ZW1wID0gb3B0W2VdKSAhPT0gbnVsbCAmJiBvcHQudGFnTmFtZSA9PSBcIkxJXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0ID0gdGVtcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCh0ZW1wID0gb3B0LnBhcmVudEVsZW1lbnRbZV0pICE9PSBudWxsICYmIHRlbXAuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiB0ZW1wLnRhZ05hbWUgPT0gXCJVTFwiKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdCA9IHRlbXAuY2hpbGRyZW5bKGtleSA9PSA0MCk/IDA6IHRlbXAuY2hpbGRyZW4ubGVuZ3RoLTFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYob3B0ICYmICghY0hBUyhvcHQsIFwiZHJvcGRvd24tb3B0aW9uXCIpIHx8IGNIQVMob3B0LCBcImRpc2FibGVkXCIpKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9IHdoaWxlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoIW9wdCAmJiBrZXkgPT0gNDApe1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdCA9IHNlbGYuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93bi1vcHRpb246bm90KC5kaXNhYmxlZClcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIW9wdCAmJiBrZXkgPT0gMzgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcCA9IHNlbGYuZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbChcIi5kcm9wZG93bi1vcHRpb246bm90KC5kaXNhYmxlZClcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0ID0gdG1wW3RtcC5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKG9wdCAmJiAoaW5uZXIgPSBzZWxmLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd24taW5uZXJcIikpKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gKGZ1bmN0aW9uKGVsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yID0ge3RvcDogZWwub2Zmc2V0VG9wLCBoZWlnaHQ6IGVsLm9mZnNldEhlaWdodH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlKChlbCA9IGVsLnBhcmVudEVsZW1lbnQpICE9IGlubmVyKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yLnRvcCArPSBlbC5vZmZzZXRUb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pKG9wdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY0FERChvcHQsIFwiaG92ZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5uZXIuc2Nyb2xsVG9wID0gTWF0aC5tYXgoMCwgcG9zLnRvcCAtIChwb3MuaGVpZ2h0ICogMikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2xvc2VcclxuICAgICAgICAgICAgZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXYpe1xyXG4gICAgICAgICAgICAgICAgaWYoIWNIQVMoc2VsZi5zZWxlY3QsIFwiYWN0aXZlXCIpIHx8IGNIQVMoc2VsZi5zZWxlY3QsIFwiaWRsZVwiKSl7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2VsZi5jb24uc3RheU9wZW4gPT09IHRydWUpeyByZXR1cm4gZmFsc2U7IH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0cyA9IFtzZWxmLmUsIHNlbGYuc2VsZWN0LCBzZWxmLmNvbnRhaW5lcl07XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGwgPSB0YXJnZXRzLmxlbmd0aCwgaSA9IDA7IGkgPCBsOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRhcmdldHNbaV0gJiYgKHRhcmdldHNbaV0uY29udGFpbnMoZXYudGFyZ2V0KSB8fCB0YXJnZXRzW2ldID09IGV2LnRhcmdldCkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKCFldi50YXJnZXQucGFyZW50RWxlbWVudCl7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY2xvc2UuY2FsbChzZWxmLCBzZWxmLmNvbi5hbmltYXRlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBCaW5kIFNvdXJjZSBTZWxlY3RcclxuICAgICAgICAgICAgaWYoIXRoaXMuY29uLnNvdXJjZUJpbmQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgaWYoZXZlbnQuZGV0YWlsICE9IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgaWYoIXRoaXMubXVsdGlwbGUgJiYgdGhpcy5zZWxlY3RlZEluZGV4KXtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMuc2VsZWN0LmNhbGwoc2VsZi5vcHRpb25zLCB0aGlzLm9wdGlvbnNbdGhpcy5zZWxlY3RlZEluZGV4XSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1ID0gW10uY29uY2F0KHNlbGYub3B0aW9ucy5zZWxlY3RlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBbXS5maWx0ZXIuY2FsbCh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoXCJvcHRpb246Y2hlY2tlZFwiKSwgZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHUuaW5kZXhPZihpdGVtKSA+PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc3BsaWNlKHUuaW5kZXhPZihpdGVtKSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLndhbGsuY2FsbChzZWxmLm9wdGlvbnMsIFwidW5zZWxlY3RcIiwgdSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLndhbGsuY2FsbChzZWxmLm9wdGlvbnMsIFwic2VsZWN0XCIsIHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgSU5URVJOQUwgOjogSU5URVJOQUwgQ0FMTEJBQ0tcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTQgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihpdGVtLCBzdGF0ZSwgX2ZvcmNlKXtcclxuICAgICAgICAgICAgdmFyIHJrZXkgPSBpdGVtLmtleS5yZXBsYWNlKC8oJ3xcXFxcKS9nLCBcIlxcXFwkMVwiKSxcclxuICAgICAgICAgICAgICAgIHJncnAgPSBpdGVtLmdyb3VwLnJlcGxhY2UoLygnfFxcXFwpL2csIFwiXFxcXCQxXCIpLFxyXG4gICAgICAgICAgICAgICAgcnNlbCA9IFwiW2RhdGEta2V5PSdcIiArIHJrZXkgKyBcIiddW2RhdGEtZ3JvdXA9J1wiICsgcmdycCArIFwiJ11cIjtcclxuICAgICAgICAgICAgaWYoc3RhdGUgPT0gXCJyZWJ1aWxkXCIpeyByZXR1cm4gdGhpcy5xdWVyeSgpOyB9XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgRWxlbWVudC1JdGVtIFN0YXRlc1xyXG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3Rvcihyc2VsKTtcclxuICAgICAgICAgICAgaWYoZWxlbWVudCAmJiBbXCJzZWxlY3RcIiwgXCJkaXNhYmxlXCJdLmluZGV4T2Yoc3RhdGUpID49IDApe1xyXG4gICAgICAgICAgICAgICAgY0FERChlbGVtZW50LCAoc3RhdGUgPT0gXCJzZWxlY3RcIj8gXCJzZWxlY3RlZFwiOiBcImRpc2FibGVkXCIpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKGVsZW1lbnQgJiYgW1widW5zZWxlY3RcIiwgXCJlbmFibGVcIl0uaW5kZXhPZihzdGF0ZSkgPj0gMCl7XHJcbiAgICAgICAgICAgICAgICBjUkVNKGVsZW1lbnQsIChzdGF0ZSA9PSBcInVuc2VsZWN0XCI/IFwic2VsZWN0ZWRcIjogXCJkaXNhYmxlZFwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEhhbmRsZVxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZShpdGVtKTtcclxuICAgICAgICAgICAgcmV0dXJuIChfZm9yY2UgPT09IHRydWUpPyB0cnVlOiB0aGlzLnRyaWdnZXIoXCJjaGFuZ2VcIiwgaXRlbSwgc3RhdGUpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIElOVEVSTkFMIDo6IFRSSUdHRVIgRVZFTlQgSEFORExFUlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4yIFswLjQuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuX2luaXQpeyByZXR1cm4gZmFsc2U7IH1cclxuICAgICAgICAgICAgdmFyIG9iaiA9IHtidWJibGVzOiBmYWxzZSwgY2FuY2VsYWJsZTogdHJ1ZSwgZGV0YWlsOiB7YXJnczogYXJndW1lbnRzLCBzZWxmOiB0aGlzfX07XHJcbiAgICAgICAgICAgIGlmKGV2ZW50ID09IFwiY2hhbmdlXCIgJiYgYXJndW1lbnRzWzJdICYmIGFyZ3VtZW50c1syXS5pbmRleE9mKFwic2VsZWN0XCIpID49IDApe1xyXG4gICAgICAgICAgICAgICAgdHJpZ2dlcih0aGlzLmUsIFwiaW5wdXRcIiwgb2JqKTtcclxuICAgICAgICAgICAgICAgIHRyaWdnZXIodGhpcy5lLCBcImNoYW5nZVwiLCBvYmopO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRyaWdnZXIodGhpcy5zZWxlY3QsIFwidGFpbDo6XCIgKyBldmVudCwgb2JqKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gW10sIHBhc3M7XHJcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChhcmd1bWVudHMsIGZ1bmN0aW9uKGl0ZW0sIGkpe1xyXG4gICAgICAgICAgICAgICAgaWYoaSA+IDApeyBhcmdzLnB1c2goaXRlbSk7IH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICh0aGlzLmV2ZW50c1tldmVudF0gfHwgW10pLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBwYXNzID0gW10uY29uY2F0KGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgcGFzcy5wdXNoKGl0ZW0uYXJncyB8fCBudWxsKTtcclxuICAgICAgICAgICAgICAgIChpdGVtLmNiIHx8IGZ1bmN0aW9uKCl7IH0pLmFwcGx5KG9iai5kZXRhaWwuc2VsZiwgcGFzcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBJTlRFUk5BTCA6OiBDQUxDVUxBVEUgRFJPUERPV05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuNCBbMC41LjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY2FsYzogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGNsb25lID0gdGhpcy5kcm9wZG93bi5jbG9uZU5vZGUodHJ1ZSksIGhlaWdodCA9IHRoaXMuY29uLmhlaWdodCwgc2VhcmNoID0gMCxcclxuICAgICAgICAgICAgICAgIGlubmVyID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duLWlubmVyXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIERyb3Bkb3duIEhlaWdodFxyXG4gICAgICAgICAgICBjbG9uZSA9IHRoaXMuZHJvcGRvd24uY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgICAgICBjbG9uZS5zdHlsZS5jc3NUZXh0ID0gXCJoZWlnaHQ6YXV0bzttaW4taGVpZ2h0OmF1dG87bWF4LWhlaWdodDpub25lO29wYWNpdHk6MDtkaXNwbGF5OmJsb2NrO3Zpc2liaWxpdHk6aGlkZGVuO1wiO1xyXG4gICAgICAgICAgICBjbG9uZS5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLmNvbi5oZWlnaHQgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIGNsb25lLmNsYXNzTmFtZSArPSBcIiBjbG9uZWRcIjtcclxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNsb25lKTtcclxuICAgICAgICAgICAgaGVpZ2h0ID0gKGhlaWdodCA+IGNsb25lLmNsaWVudEhlaWdodCk/IGNsb25lLmNsaWVudEhlaWdodDogaGVpZ2h0O1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbi5zZWFyY2gpe1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoID0gY2xvbmUucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93bi1zZWFyY2hcIikuY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChjbG9uZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgVmlld3BvcnRcclxuICAgICAgICAgICAgdmFyIHBvcyA9IHRoaXMuc2VsZWN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxyXG4gICAgICAgICAgICAgICAgYm90dG9tID0gdy5pbm5lckhlaWdodC0ocG9zLnRvcCtwb3MuaGVpZ2h0KSxcclxuICAgICAgICAgICAgICAgIHZpZXcgPSAoKGhlaWdodCtzZWFyY2gpID4gYm90dG9tKT8gcG9zLnRvcCA+IGJvdHRvbTogZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29uLm9wZW5BYm92ZSA9PT0gdHJ1ZSB8fCAodGhpcy5jb24ub3BlbkFib3ZlICE9PSBmYWxzZSAmJiB2aWV3KSl7XHJcbiAgICAgICAgICAgICAgICB2aWV3ID0gdHJ1ZSwgaGVpZ2h0ID0gTWF0aC5taW4oKGhlaWdodCksIHBvcy50b3AtMTApO1xyXG4gICAgICAgICAgICAgICAgY0FERCh0aGlzLnNlbGVjdCwgXCJvcGVuLXRvcFwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZpZXcgPSBmYWxzZSwgaGVpZ2h0ID0gTWF0aC5taW4oKGhlaWdodCksIGJvdHRvbS0xMCk7XHJcbiAgICAgICAgICAgICAgICBjUkVNKHRoaXMuc2VsZWN0LCBcIm9wZW4tdG9wXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGlubmVyKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc3R5bGUubWF4SGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgaW5uZXIuc3R5bGUubWF4SGVpZ2h0ID0gKGhlaWdodC1zZWFyY2gpICsgXCJweFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIEFQSSA6OiBRVUVSWSBPUFRJT05TXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjEzIFswLjUuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBxdWVyeTogZnVuY3Rpb24oc2VhcmNoLCBjb25mKXtcclxuICAgICAgICAgICAgdmFyIGl0ZW0sIHRwLCB1bCwgbGksIGExLCBhMjsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmUtRGVmaW5pdGlvblxyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGNvbiA9IHRoaXMuY29uLCBnID0gXCJnZXRBdHRyaWJ1dGVcIjsgICAgLy8gU2hvcnRpZXNcclxuICAgICAgICAgICAgdmFyIHJvb3QgPSBjcmVhdGUoXCJESVZcIiwgXCJkcm9wZG93bi1pbm5lclwiKSwgICAgICAgICAgICAgLy8gQ29udGV4dHNcclxuICAgICAgICAgICAgICAgIGZ1bmMgPSAoIXNlYXJjaCk/IFwid2Fsa2VyXCI6IFwiZmluZGVyXCIsXHJcbiAgICAgICAgICAgICAgICBhcmdzID0gKCFzZWFyY2gpPyBbY29uLnNvcnRJdGVtcywgY29uLnNvcnRHcm91cHNdOiBbc2VhcmNoLCBjb25mXTtcclxuXHJcbiAgICAgICAgICAgIC8vIE9wdGlvbiBXYWxrZXJcclxuICAgICAgICAgICAgdGhpcy5fcXVlcnkgPSAodHlwZW9mKHNlYXJjaCkgPT0gXCJzdHJpbmdcIik/IHNlYXJjaDogZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlKGl0ZW0gPSB0aGlzLm9wdGlvbnNbZnVuY10uYXBwbHkodGhpcy5vcHRpb25zLCBhcmdzKSl7XHJcbiAgICAgICAgICAgICAgICBpZighdWwgfHwgKHVsICYmIHVsW2ddKFwiZGF0YS1ncm91cFwiKSAhPT0gaXRlbS5ncm91cCkpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRwID0gKGNvbi5jYkxvb3BHcm91cCB8fCB0aGlzLmNiR3JvdXApLmNhbGwodGhpcywgaXRlbS5ncm91cCwgc2VhcmNoLCByb290KTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0cCBpbnN0YW5jZW9mIEVsZW1lbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bCA9IHRwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWdyb3VwXCIsIGl0ZW0uZ3JvdXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb290LmFwcGVuZENoaWxkKHVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBJdGVtXHJcbiAgICAgICAgICAgICAgICBpZigobGkgPSAoY29uLmNiTG9vcEl0ZW0gfHwgdGhpcy5jYkl0ZW0pLmNhbGwodGhpcywgaXRlbSwgdWwsIHNlYXJjaCwgcm9vdCkpID09PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKGxpID09PSBmYWxzZSl7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICBsaS5zZXRBdHRyaWJ1dGUoXCJkYXRhLWtleVwiLCBpdGVtLmtleSk7XHJcbiAgICAgICAgICAgICAgICBsaS5zZXRBdHRyaWJ1dGUoXCJkYXRhLWdyb3VwXCIsIGl0ZW0uZ3JvdXApO1xyXG4gICAgICAgICAgICAgICAgbGkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5oYXNBdHRyaWJ1dGUoXCJkYXRhLWtleVwiKSl7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSB0aGlzW2ddKFwiZGF0YS1rZXlcIiksIGdyb3VwID0gdGhpc1tnXShcImRhdGEtZ3JvdXBcIikgfHwgXCIjXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZi5vcHRpb25zLnRvZ2dsZS5jYWxsKHNlbGYub3B0aW9ucywga2V5LCBncm91cCkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxmLmNvbi5zdGF5T3BlbiA9PT0gZmFsc2UgJiYgIXNlbGYuY29uLm11bHRpcGxlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UuY2FsbChzZWxmLCBzZWxmLmNvbi5hbmltYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdWwuYXBwZW5kQ2hpbGQobGkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBFbXB0eVxyXG4gICAgICAgICAgICB2YXIgY291bnQgPSByb290LnF1ZXJ5U2VsZWN0b3JBbGwoXCIqW2RhdGEta2V5XVwiKS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGlmKGNvdW50ID09IDApe1xyXG4gICAgICAgICAgICAgICAgKHRoaXMuY29uLmNiRW1wdHkgfHwgZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpID0gY3JlYXRlKFwiU1BBTlwiLCBcImRyb3Bkb3duLWVtcHR5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpLmlubmVyVGV4dCA9IHRoaXMuX2UoXCJlbXB0eVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGxpKTtcclxuICAgICAgICAgICAgICAgIH0pLmNhbGwodGhpcywgcm9vdCwgc2VhcmNoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU2VsZWN0IEFsbFxyXG4gICAgICAgICAgICBpZihjb3VudCA+IDAgJiYgY29uLm11bHRpcGxlICYmIGNvbi5tdWx0aUxpbWl0ID09IEluZmluaXR5ICYmIGNvbi5tdWx0aVNlbGVjdEFsbCl7XHJcbiAgICAgICAgICAgICAgICBhMSA9IGNyZWF0ZShcIkJVVFRPTlwiLCBcInRhaWwtYWxsXCIpLCBhMiA9IGNyZWF0ZShcIkJVVFRPTlwiLCBcInRhaWwtbm9uZVwiKTtcclxuICAgICAgICAgICAgICAgIGExLmlubmVyVGV4dCA9IHRoaXMuX2UoXCJhbGxcIik7XHJcbiAgICAgICAgICAgICAgICBhMS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBzZWxmLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZHJvcGRvd24taW5uZXIgLmRyb3Bkb3duLW9wdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMud2Fsay5jYWxsKHNlbGYub3B0aW9ucywgXCJzZWxlY3RcIiwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgYTIuaW5uZXJUZXh0ID0gdGhpcy5fZShcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICBhMi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBzZWxmLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZHJvcGRvd24taW5uZXIgLmRyb3Bkb3duLW9wdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMud2Fsay5jYWxsKHNlbGYub3B0aW9ucywgXCJ1bnNlbGVjdFwiLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRkIEVsZW1lbnRcclxuICAgICAgICAgICAgICAgIGxpID0gY3JlYXRlKFwiU1BBTlwiLCBcImRyb3Bkb3duLWFjdGlvblwiKTtcclxuICAgICAgICAgICAgICAgIGxpLmFwcGVuZENoaWxkKGExKTtcclxuICAgICAgICAgICAgICAgIGxpLmFwcGVuZENoaWxkKGEyKTtcclxuICAgICAgICAgICAgICAgIHJvb3QuaW5zZXJ0QmVmb3JlKGxpLCByb290LmNoaWxkcmVuWzBdKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWRkIGFuZCBSZXR1cm5cclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd24taW5uZXJcIik7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd25bKGRhdGE/IFwicmVwbGFjZVwiOiBcImFwcGVuZFwiKSArIFwiQ2hpbGRcIl0ocm9vdCwgZGF0YSk7XHJcbiAgICAgICAgICAgIGlmKGNIQVModGhpcy5zZWxlY3QsIFwiYWN0aXZlXCIpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FsYygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUNTVigpLnVwZGF0ZUxhYmVsKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgQVBJIDo6IENBTExCQUNLIC0+IENSRUFURSBHUk9VUFxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS44IFswLjQuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBjYkdyb3VwOiBmdW5jdGlvbihncm91cCwgc2VhcmNoKXtcclxuICAgICAgICAgICAgdmFyIHVsID0gY3JlYXRlKFwiVUxcIiwgXCJkcm9wZG93bi1vcHRncm91cFwiKSwgc2VsZiA9IHRoaXMsIGExLCBhMjtcclxuICAgICAgICAgICAgaWYoZ3JvdXAgPT0gXCIjXCIpeyByZXR1cm4gdWw7IH1cclxuICAgICAgICAgICAgdWwuaW5uZXJIVE1MID0gJzxsaSBjbGFzcz1cIm9wdGdyb3VwLXRpdGxlXCI+PGI+JyArIGdyb3VwICsgJzwvYj48L2xpPic7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29uLm11bHRpcGxlICYmIHRoaXMuY29uLm11bHRpTGltaXQgPT0gSW5maW5pdHkgJiYgdGhpcy5jb24ubXVsdGlTZWxlY3RBbGwpe1xyXG4gICAgICAgICAgICAgICAgYTEgPSBjcmVhdGUoXCJCVVRUT05cIiwgXCJ0YWlsLW5vbmVcIiksIGEyID0gY3JlYXRlKFwiQlVUVE9OXCIsIFwidGFpbC1hbGxcIik7XHJcbiAgICAgICAgICAgICAgICBhMS5pbm5lclRleHQgPSB0aGlzLl9lKFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgIGExLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JwID0gdGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1ncm91cFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMuYWxsLmNhbGwoc2VsZi5vcHRpb25zLCBcInVuc2VsZWN0XCIsIGdycCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGEyLmlubmVyVGV4dCA9IHRoaXMuX2UoXCJhbGxcIik7XHJcbiAgICAgICAgICAgICAgICBhMi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdycCA9IHRoaXMucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtZ3JvdXBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLmFsbC5jYWxsKHNlbGYub3B0aW9ucywgXCJzZWxlY3RcIiwgZ3JwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdWwuY2hpbGRyZW5bMF0uYXBwZW5kQ2hpbGQoYTEpO1xyXG4gICAgICAgICAgICAgICAgdWwuY2hpbGRyZW5bMF0uYXBwZW5kQ2hpbGQoYTIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB1bDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBBUEkgOjogQ0FMTEJBQ0sgLT4gQ1JFQVRFIElURU1cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTMgWzAuNC4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNiSXRlbTogZnVuY3Rpb24oaXRlbSwgb3B0Z3JvdXAsIHNlYXJjaCl7XHJcbiAgICAgICAgICAgIHZhciBsaSA9IGNyZWF0ZShcIkxJXCIsIFwiZHJvcGRvd24tb3B0aW9uXCIgKyAoaXRlbS5zZWxlY3RlZD8gXCIgc2VsZWN0ZWRcIjogXCJcIikgKyAoaXRlbS5kaXNhYmxlZD8gXCIgZGlzYWJsZWRcIjogXCJcIikpO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5uZXIgVGV4dFxyXG4gICAgICAgICAgICBpZihzZWFyY2ggJiYgc2VhcmNoLmxlbmd0aCA+IDAgJiYgdGhpcy5jb24uc2VhcmNoTWFya2VkKXtcclxuICAgICAgICAgICAgICAgIHNlYXJjaCA9IHRoaXMub3B0aW9ucy5hcHBseUxpbmd1aXN0aWNSdWxlcyhzZWFyY2gpO1xyXG4gICAgICAgICAgICAgICAgbGkuaW5uZXJIVE1MID0gaXRlbS52YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCIoXCIgKyBzZWFyY2ggKyBcIilcIiwgXCJpXCIpLCBcIjxtYXJrPiQxPC9tYXJrPlwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxpLmlubmVyVGV4dCA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElubmVyIERlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29uLmRlc2NyaXB0aW9ucyAmJiBpdGVtLmRlc2NyaXB0aW9uKXtcclxuICAgICAgICAgICAgICAgIGxpLmlubmVySFRNTCArPSAnPHNwYW4gY2xhc3M9XCJvcHRpb24tZGVzY3JpcHRpb25cIj4nICsgaXRlbS5kZXNjcmlwdGlvbiArICc8L3NwYW4+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbGk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgQVBJIDo6IFVQREFURSBFVkVSWVRISU5HXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjAgWzAuNS4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUxhYmVsKCkudXBkYXRlQ29udGFpbmVyKGl0ZW0pLnVwZGF0ZVBpbihpdGVtKS51cGRhdGVDU1YoaXRlbSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgQVBJIDo6IFVQREFURSBMQUJFTFxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS44IFswLjUuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICB1cGRhdGVMYWJlbDogZnVuY3Rpb24obGFiZWwpe1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbnRhaW5lciA9PSB0aGlzLmxhYmVsICYmIHRoaXMub3B0aW9ucy5zZWxlY3RlZC5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMubGFiZWwucXVlcnlTZWxlY3RvcihcIi5sYWJlbC1pbm5lclwiKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5yZW1vdmVDaGlsZCh0aGlzLmxhYmVsLnF1ZXJ5U2VsZWN0b3IoXCIubGFiZWwtaW5uZXJcIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5sYWJlbC5xdWVyeVNlbGVjdG9yKFwiLmxhYmVsLWNvdW50XCIpKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsLnJlbW92ZUNoaWxkKHRoaXMubGFiZWwucXVlcnlTZWxlY3RvcihcIi5sYWJlbC1jb3VudFwiKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuY29uLCBsZW4gPSB0aGlzLm9wdGlvbnMuc2VsZWN0ZWQubGVuZ3RoLCBsaW1pdDtcclxuICAgICAgICAgICAgaWYodHlwZW9mKGxhYmVsKSAhPSBcInN0cmluZ1wiKXtcclxuICAgICAgICAgICAgICAgIGlmKGMuZGlzYWJsZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gXCJkaXNhYmxlZFwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbChcIipbZGF0YS1rZXldXCIpLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IFwiZW1wdHlcIiArIChjSEFTKHRoaXMuc2VsZWN0LCBcImluLXNlYXJjaFwiKT8gXCJTZWFyY2hcIjogXCJcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoYy5tdWx0aUxpbWl0IDw9IGxlbil7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSBcImxpbWl0XCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIWMubXVsdGlwbGUgJiYgdGhpcy5vcHRpb25zLnNlbGVjdGVkLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gdGhpcy5vcHRpb25zLnNlbGVjdGVkWzBdLmlubmVyVGV4dDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlb2YoYy5wbGFjZWhvbGRlcikgPT0gXCJzdHJpbmdcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSBjLnBsYWNlaG9sZGVyO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IFwicGxhY2Vob2xkZXJcIiArIChjLm11bHRpcGxlICYmIGMubXVsdGlMaW1pdCA8IEluZmluaXR5PyBcIk11bHRpXCI6IFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgSFRNTFxyXG4gICAgICAgICAgICBsYWJlbCA9IHRoaXMuX2UobGFiZWwsIHtcIjpsaW1pdFwiOiBjLm11bHRpTGltaXR9LCBsYWJlbCk7XHJcbiAgICAgICAgICAgIGxhYmVsID0gJzxzcGFuIGNsYXNzPVwibGFiZWwtaW5uZXJcIj4nICsgbGFiZWwgKyAnPC9zcGFuPicsXHJcbiAgICAgICAgICAgIGxpbWl0ID0gKGMubXVsdGlTaG93TGltaXQgJiYgYy5tdWx0aUxpbWl0IDwgSW5maW5pdHkpO1xyXG4gICAgICAgICAgICBpZihjLm11bHRpcGxlICYmIGMubXVsdGlTaG93Q291bnQpe1xyXG4gICAgICAgICAgICAgICAgbGFiZWwgPSAnPHNwYW4gY2xhc3M9XCJsYWJlbC1jb3VudFwiPjpjPC9zcGFuPicgKyBsYWJlbDtcclxuICAgICAgICAgICAgICAgIGxhYmVsID0gbGFiZWwucmVwbGFjZShcIjpjXCIsIGxlbiArIChsaW1pdD8gKFwiIC8gXCIgKyBjLm11bHRpTGltaXQpOiBcIlwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sYWJlbC5pbm5lckhUTUwgPSBsYWJlbDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgQVBJIDo6IFVQREFURSBDT05UQUlORVJcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC41LjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdXBkYXRlQ29udGFpbmVyOiBmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgaWYoIXRoaXMuY29udGFpbmVyIHx8ICF0aGlzLmNvbi5tdWx0aUNvbnRhaW5lcil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcyA9IFwiW2RhdGEtZ3JvdXA9J1wiICsgaXRlbS5ncm91cCArIFwiJ11bZGF0YS1rZXk9J1wiICsgaXRlbS5rZXkgKyBcIiddXCI7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3Iocykpe1xyXG4gICAgICAgICAgICAgICAgaWYoIWl0ZW0uc2VsZWN0ZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IocykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBJdGVtXHJcbiAgICAgICAgICAgIGlmKGl0ZW0uc2VsZWN0ZWQpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBobmRsID0gY3JlYXRlKFwiRElWXCIsIFwic2VsZWN0LWhhbmRsZVwiKTtcclxuICAgICAgICAgICAgICAgIGhuZGwuaW5uZXJUZXh0ID0gaXRlbS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGhuZGwuc2V0QXR0cmlidXRlKFwiZGF0YS1rZXlcIiwgaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaG5kbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWdyb3VwXCIsIGl0ZW0uZ3JvdXApO1xyXG4gICAgICAgICAgICAgICAgaG5kbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGF0YS1rZXlcIiksIGdycCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGF0YS1ncm91cFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMudW5zZWxlY3QuY2FsbChzZWxmLm9wdGlvbnMsIGtleSwgZ3JwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoaG5kbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgQVBJIDo6IFVQREFURSBQSU4gUE9TSVRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMyBbMC41LjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdXBkYXRlUGluOiBmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgdmFyIGlubmVyID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duLWlubmVyIHVsXCIpLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uID0gXCJsaVtkYXRhLWtleT0nXCIgKyBpdGVtLmtleSArIFwiJ11bZGF0YS1ncm91cD0nXCIgKyBpdGVtLmdyb3VwICsgXCInXVwiO1xyXG4gICAgICAgICAgICBpZighdGhpcy5jb24ubXVsdGlQaW5TZWxlY3RlZCB8fCAhaW5uZXIgfHwgdGhpcy5fcXVlcnkgIT09IGZhbHNlKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgSXRlbVxyXG4gICAgICAgICAgICBvcHRpb24gPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3Iob3B0aW9uKTtcclxuICAgICAgICAgICAgaWYoaXRlbS5zZWxlY3RlZCl7XHJcbiAgICAgICAgICAgICAgICBpbm5lci5pbnNlcnRCZWZvcmUob3B0aW9uLCBpbm5lci5jaGlsZHJlblswXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JwID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwidWxbZGF0YS1ncm91cD0nXCIgKyBpdGVtLmdyb3VwICsgXCInXVwiKSxcclxuICAgICAgICAgICAgICAgICAgICBwcmV2ID0gdGhpcy5vcHRpb25zW2l0ZW0uaW5kZXgtMV0sIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB3aGlsZShwcmV2ICYmIHByZXYuZ3JvdXAgPT0gaXRlbS5ncm91cCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZm91bmQgPSBncnAucXVlcnlTZWxlY3RvcihcImxpW2RhdGEta2V5PSdcIiArIHByZXYua2V5ICsgXCInXVwiKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwcmV2ID0gdGhpcy5vcHRpb25zW3ByZXYuaW5kZXgtMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihmb3VuZCAmJiBmb3VuZC5uZXh0RWxlbWVudFNpYmxpbmcpe1xyXG4gICAgICAgICAgICAgICAgICAgIGdycC5pbnNlcnRCZWZvcmUob3B0aW9uLCBmb3VuZC5uZXh0RWxlbWVudFNpYmxpbmcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBncnAuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBBUEkgOjogVVBEQVRFIENTViBJTlBVVFxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4wIFswLjUuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICB1cGRhdGVDU1Y6IGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICBpZighdGhpcy5jc3ZJbnB1dCB8fCAhdGhpcy5jb24uY3N2T3V0cHV0KXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvcih2YXIgc2VsZWN0ZWQgPSBbXSwgbCA9IHRoaXMub3B0aW9ucy5zZWxlY3RlZC5sZW5ndGgsIGkgPSAwOyBpIDwgbDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkLnB1c2godGhpcy5vcHRpb25zLnNlbGVjdGVkW2ldLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNzdklucHV0LnZhbHVlID0gc2VsZWN0ZWQuam9pbih0aGlzLmNvbi5jc3ZTZXBhcmF0b3IgfHwgXCIsXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBQVUJMSUMgOjogT1BFTiBEUk9QRE9XTlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4wIFswLjMuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBvcGVuOiBmdW5jdGlvbihhbmltYXRlKXtcclxuICAgICAgICAgICAgaWYoY0hBUyh0aGlzLnNlbGVjdCwgXCJhY3RpdmVcIikgfHwgY0hBUyh0aGlzLnNlbGVjdCwgXCJpZGxlXCIpIHx8IHRoaXMuY29uLmRpc2FibGVkKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNhbGMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmFsIEZ1bmN0aW9uXHJcbiAgICAgICAgICAgIHZhciBmaW5hbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBjQUREKHNlbGYuc2VsZWN0LCBcImFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgIGNSRU0oc2VsZi5zZWxlY3QsIFwiaWRsZVwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnN0eWxlLm92ZXJmbG93ID0gXCJ2aXNpYmxlXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsLnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5jb24uc2VhcmNoICYmIHRoaXMuY29uLnNlYXJjaEZvY3VzKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyLmNhbGwodGhpcywgXCJvcGVuXCIpO1xyXG4gICAgICAgICAgICB9LCBzZWxmID0gdGhpcywgZSA9IHRoaXMuZHJvcGRvd24uc3R5bGU7XHJcblxyXG4gICAgICAgICAgICAvLyBPcGVuXHJcbiAgICAgICAgICAgIGlmKGFuaW1hdGUgIT09IGZhbHNlKXtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwuc3R5bGUuekluZGV4ID0gMjU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnN0eWxlLmNzc1RleHQgKz0gXCJoZWlnaHQ6MDtkaXNwbGF5OmJsb2NrO292ZXJmbG93OmhpZGRlbjtcIjtcclxuICAgICAgICAgICAgICAgIGNBREQoc2VsZi5zZWxlY3QsIFwiaWRsZVwiKTtcclxuICAgICAgICAgICAgICAgIChmdW5jdGlvbiBhbmltYXRlKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBwYXJzZUludChlLmhlaWdodCwgMTApLCBtID0gcGFyc2VJbnQoZS5tYXhIZWlnaHQsIDEwKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihoID49IG0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmluYWwuY2FsbChzZWxmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZS5oZWlnaHQgPSAoKGgrNTAgPiBtKT8gbTogaCs1MCkgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChhbmltYXRlLCAyMCk7XHJcbiAgICAgICAgICAgICAgICB9KSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZS5jc3NUZXh0ID0gXCJoZWlnaHQ6XCIgKyBlLm1heEhlaWdodCArIFwiO2Rpc3BsYXk6YmxvY2s7b3ZlcmZsb3c6aGlkZGVuO1wiO1xyXG4gICAgICAgICAgICAgICAgZmluYWwuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBQVUJMSUMgOjogQ0xPU0UgRFJPUERPV05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGFuaW1hdGUpe1xyXG4gICAgICAgICAgICBpZighY0hBUyh0aGlzLnNlbGVjdCwgXCJhY3RpdmVcIikgfHwgY0hBUyh0aGlzLnNlbGVjdCwgXCJpZGxlXCIpKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgZmluYWwgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgY1JFTSh0aGlzLnNlbGVjdCwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICBjUkVNKHRoaXMuc2VsZWN0LCBcImlkbGVcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duLWlubmVyXCIpLnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyLmNhbGwodGhpcywgXCJjbG9zZVwiKTtcclxuICAgICAgICAgICAgfSwgc2VsZiA9IHRoaXMsIGUgPSB0aGlzLmRyb3Bkb3duO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2xvc2VcclxuICAgICAgICAgICAgaWYoYW5pbWF0ZSAhPT0gZmFsc2Upe1xyXG4gICAgICAgICAgICAgICAgY0FERCh0aGlzLnNlbGVjdCwgXCJpZGxlXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gYW5pbWF0ZSgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKChwYXJzZUludChlLm9mZnNldEhlaWdodCwgMTApLTUwKSA8PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsLmNhbGwoc2VsZik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGUuc3R5bGUuaGVpZ2h0ID0gKHBhcnNlSW50KGUub2Zmc2V0SGVpZ2h0LCAxMCktNTApICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYW5pbWF0ZSwgMjApO1xyXG4gICAgICAgICAgICAgICAgfSkoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZpbmFsLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgUFVCTElDIDo6IFRPR0dMRSBEUk9QRE9XTlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4wIFswLjMuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGFuaW1hdGUpe1xyXG4gICAgICAgICAgICBpZihjSEFTKHRoaXMuc2VsZWN0LCBcImFjdGl2ZVwiKSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZShhbmltYXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gIWNIQVModGhpcy5zZWxlY3QsIFwiaWRsZVwiKT8gdGhpcy5vcGVuKGFuaW1hdGUpOiB0aGlzO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIFBVQkxJQyA6OiBSRU1PVkUgU0VMRUNUXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjMgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHJlbW92ZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdGhpcy5lLnJlbW92ZUF0dHJpYnV0ZShcImRhdGEtdGFpbC1zZWxlY3RcIik7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZS5oYXNBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjdC1oaWRkZW5cIikpe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5lLmdldEF0dHJpYnV0ZShcImRhdGEtc2VsZWN0LWhpZGRlblwiKSA9PSBcIjBcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLnJlbW92ZVByb3BlcnR5KFwiZGlzcGxheVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZS5yZW1vdmVBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjdC1oaWRkZW5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKHRoaXMuZS5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtc2VsZWN0LW9wdGlvbj0nYWRkJ11cIiksIGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgaXRlbS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUubWFwLmNhbGwodGhpcy5lLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1zZWxlY3Qtb3B0Z3JvdXA9J2FkZCddXCIpLCBmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgICAgIGl0ZW0ucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChpdGVtKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5lLm5hbWUgPSAodGhpcy5jc3ZJbnB1dC5oYXNBdHRyaWJ1dGUoXCJuYW1lXCIpKT8gdGhpcy5jc3ZJbnB1dC5uYW1lOiB0aGlzLmUubmFtZTtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3QucGFyZW50RWxlbWVudCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuc2VsZWN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLmNvbnRhaW5lcil7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlcyA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VsZWN0LWhhbmRsZVwiKTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgbCA9IGhhbmRsZXMubGVuZ3RoLCBpID0gMDsgaSA8IGw7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQoaGFuZGxlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgUFVCTElDIDo6IFJFTE9BRCBTRUxFQ1RcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmVsb2FkOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUoKS5pbml0KCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgUFVCTElDIDo6IEdFVHxTRVQgQ09ORklHXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjE1IFswLjQuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25maWc6IGZ1bmN0aW9uKGtleSwgdmFsdWUsIHJlYnVpbGQpe1xyXG4gICAgICAgICAgICBpZihrZXkgaW5zdGFuY2VvZiBPYmplY3Qpe1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBrIGluIGtleSl7IHRoaXMuY29uZmlnKGssIGtleVtrXSwgZmFsc2UpOyB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWxvYWQoKT8gdGhpcy5jb246IHRoaXMuY29uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZihrZXkpID09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYoIShrZXkgaW4gdGhpcy5jb24pKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHwgUmV0dXJuXHJcbiAgICAgICAgICAgIGlmKHR5cGVvZih2YWx1ZSkgPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25ba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNvbltrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmKHJlYnVpbGQgIT09IGZhbHNlKXtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKHVwZGF0ZSl7XHJcbiAgICAgICAgICAgIGNSRU0odGhpcy5zZWxlY3QsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgIHRoaXMuZS5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmNvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gKHVwZGF0ZSA9PT0gZmFsc2UpPyB0aGlzOiB0aGlzLnJlbG9hZCgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24odXBkYXRlKXtcclxuICAgICAgICAgICAgY0FERCh0aGlzLnNlbGVjdCwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgdGhpcy5lLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jb24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gKHVwZGF0ZSA9PT0gZmFsc2UpPyB0aGlzOiB0aGlzLnJlbG9hZCgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIFBVQkxJQyA6OiBDVVNUT00gRVZFTlQgTElTVEVORVJcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC40LjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb246IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaywgYXJncyl7XHJcbiAgICAgICAgICAgIGlmKFtcIm9wZW5cIiwgXCJjbG9zZVwiLCBcImNoYW5nZVwiXS5pbmRleE9mKGV2ZW50KSA8IDAgfHwgdHlwZW9mKGNhbGxiYWNrKSAhPSBcImZ1bmN0aW9uXCIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCEoZXZlbnQgaW4gdGhpcy5ldmVudHMpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XS5wdXNoKHtjYjogY2FsbGJhY2ssIGFyZ3M6IChhcmdzIGluc3RhbmNlb2YgQXJyYXkpPyBhcmdzOiBbXX0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBQVUJMSUMgOjogVkFMVUVcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTMgWzAuNS4xM11cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNlbGVjdGVkLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29uLm11bHRpcGxlKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc2VsZWN0ZWQubWFwKGZ1bmN0aW9uKG9wdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc2VsZWN0ZWRbMF0udmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgIHwgIE9QVElPTlMgQ09OU1RSVUNUT1JcclxuICAgICB8ICBAc2luY2UgIDAuNS4xMiBbMC4zLjBdXHJcbiAgICAgKi9cclxuICAgIG9wdGlvbnMgPSBzZWxlY3Qub3B0aW9ucyA9IGZ1bmN0aW9uKHNlbGVjdCwgcGFyZW50KXtcclxuICAgICAgICBpZighKHRoaXMgaW5zdGFuY2VvZiBvcHRpb25zKSl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgb3B0aW9ucyhzZWxlY3QsIHBhcmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZiA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBzZWxlY3Q7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBbXTtcclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gW107XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IHtcIiNcIjoge319O1xyXG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLypcclxuICAgICB8ICBUQUlMLk9QVElPTlMgSEFORExFUlxyXG4gICAgICovXHJcbiAgICBvcHRpb25zLnByb3RvdHlwZSA9IHtcclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBJTlRFUk5BTCA6OiBSRVBMQUNFIFRZUE9zXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjAgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF9yOiBmdW5jdGlvbihzdGF0ZSl7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5yZXBsYWNlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlXCIpLnJlcGxhY2UoXCJlbmFibGVkXCIsIFwiZW5hYmxlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwic2VsZWN0ZWRcIiwgXCJzZWxlY3RcIikucmVwbGFjZShcInVuc2VsZWN0ZWRcIiwgXCJ1bnNlbGVjdFwiKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBHRVQgQU4gRVhJU1RJTkcgT1BUSU9OXHJcbiAgICAgICAgIHwgIEBzaW5jZSAgMC41LjcgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24oa2V5LCBncnApe1xyXG4gICAgICAgICAgICB2YXIgZyA9IFwiZ2V0QXR0cmlidXRlXCI7XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZihrZXkpID09IFwib2JqZWN0XCIgJiYga2V5LmtleSAmJiBrZXkuZ3JvdXApe1xyXG4gICAgICAgICAgICAgICAgZ3JwID0ga2V5Lmdyb3VwIHx8IGdycDtcclxuICAgICAgICAgICAgICAgIGtleSA9IGtleS5rZXk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihrZXkgaW5zdGFuY2VvZiBFbGVtZW50KXtcclxuICAgICAgICAgICAgICAgIGlmKGtleS50YWdOYW1lID09IFwiT1BUSU9OXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIGdycCA9IGtleS5wYXJlbnRFbGVtZW50LmxhYmVsIHx8IFwiI1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIGtleSA9IGtleS52YWx1ZSB8fCBrZXkuaW5uZXJUZXh0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKGtleS5oYXNBdHRyaWJ1dGUoXCJkYXRhLWtleVwiKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JwID0ga2V5W2ddKFwiZGF0YS1ncm91cFwiKSB8fCBrZXkucGFyZW50RWxlbWVudFtnXShcImRhdGEtZ3JvdXBcIikgfHwgXCIjXCI7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5ID0ga2V5W2ddKFwiZGF0YS1rZXlcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlb2Yoa2V5KSAhPSBcInN0cmluZ1wiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBrZXkgPSAoL15bMC05XSskLy50ZXN0KGtleSkpPyBcIl9cIiArIGtleToga2V5O1xyXG4gICAgICAgICAgICByZXR1cm4gKGdycCBpbiB0aGlzLml0ZW1zKT8gdGhpcy5pdGVtc1tncnBdW2tleV06IGZhbHNlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIFNFVCBBTiBFWElTVElORyBPUFRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTUgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNldDogZnVuY3Rpb24ob3B0LCByZWJ1aWxkKXtcclxuICAgICAgICAgICAgdmFyIGtleSA9IG9wdC52YWx1ZSB8fCBvcHQuaW5uZXJUZXh0LCBncnAgPSBvcHQucGFyZW50RWxlbWVudC5sYWJlbCB8fCBcIiNcIjtcclxuICAgICAgICAgICAgaWYoIShncnAgaW4gdGhpcy5pdGVtcykpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc1tncnBdID0ge307XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncnBdID0gb3B0LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoa2V5IGluIHRoaXMuaXRlbXNbZ3JwXSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGlkID0gKC9eWzAtOV0rJC8udGVzdChrZXkpKT8gXCJfXCIgKyBrZXk6IGtleTtcclxuXHJcbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIFNlbGVjdGlvblxyXG4gICAgICAgICAgICB2YXIgY29uID0gdGhpcy5zZWxmLmNvbjtcclxuICAgICAgICAgICAgaWYoY29uLm11bHRpcGxlICYmIHRoaXMuc2VsZWN0ZWQubGVuZ3RoID49IGNvbi5tdWx0aUxpbWl0KXtcclxuICAgICAgICAgICAgICAgIG9wdC5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG9wdC5zZWxlY3RlZCAmJiBjb24uZGVzZWxlY3QgJiYgKCFvcHQuaGFzQXR0cmlidXRlKFwic2VsZWN0ZWRcIikgfHwgY29uLm11bHRpTGltaXQgPT0gMCkpe1xyXG4gICAgICAgICAgICAgICAgb3B0LnNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHQucGFyZW50RWxlbWVudC5zZWxlY3RlZEluZGV4ID0gLTE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNhbml0aXplIERlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgIGlmKG9wdC5oYXNBdHRyaWJ1dGUoXCJkYXRhLWRlc2NyaXB0aW9uXCIpKXtcclxuICAgICAgICAgICAgICAgIHZhciBzcGFuID0gY3JlYXRlKFwiU1BBTlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9IG9wdC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWRlc2NyaXB0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgb3B0LnNldEF0dHJpYnV0ZShcImRhdGEtZGVzY3JpcHRpb25cIiwgc3Bhbi5pbm5lckhUTUwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgSXRlbVxyXG4gICAgICAgICAgICB0aGlzLml0ZW1zW2dycF1baWRdID0ge1xyXG4gICAgICAgICAgICAgICAga2V5OiBrZXksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogb3B0LnRleHQsXHJcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogb3B0LmdldEF0dHJpYnV0ZShcImRhdGEtZGVzY3JpcHRpb25cIikgfHwgbnVsbCxcclxuICAgICAgICAgICAgICAgIGdyb3VwOiBncnAsXHJcbiAgICAgICAgICAgICAgICBvcHRpb246IG9wdCxcclxuICAgICAgICAgICAgICAgIG9wdGdyb3VwOiAoZ3JwICE9IFwiI1wiKT8gdGhpcy5ncm91cHNbZ3JwXTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCxcclxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiBvcHQuZGlzYWJsZWQsXHJcbiAgICAgICAgICAgICAgICBoaWRkZW46IG9wdC5oaWRkZW4gfHwgZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5sZW5ndGgrKztcclxuICAgICAgICAgICAgaWYob3B0LnNlbGVjdGVkKXsgdGhpcy5zZWxlY3QodGhpcy5pdGVtc1tncnBdW2lkXSk7IH1cclxuICAgICAgICAgICAgaWYob3B0LmRpc2FibGVkKXsgdGhpcy5kaXNhYmxlKHRoaXMuaXRlbXNbZ3JwXVtpZF0pOyB9XHJcbiAgICAgICAgICAgIHJldHVybiAocmVidWlsZCk/IHRoaXMuc2VsZi5jYWxsYmFjayh0aGlzLml0ZW1zW2dycF1ba2V5XSwgXCJyZWJ1aWxkXCIpOiB0cnVlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIENSRUFURSBBIE5FVyBPUFRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTMgWzAuMy4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGFkZDogZnVuY3Rpb24oa2V5LCB2YWx1ZSwgZ3JvdXAsIHNlbGVjdGVkLCBkaXNhYmxlZCwgZGVzY3JpcHRpb24sIHJlYnVpbGQpe1xyXG4gICAgICAgICAgICBpZihrZXkgaW5zdGFuY2VvZiBPYmplY3Qpe1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBrIGluIGtleSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGQoa2V5W2tdLmtleSB8fCBrLCBrZXlba10udmFsdWUsIGtleVtrXS5ncm91cCwga2V5W2tdLnNlbGVjdGVkLCBrZXlba10uZGlzYWJsZWQsIGtleVtrXS5kZXNjcmlwdGlvbiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZi5xdWVyeSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZ2V0KGtleSwgZ3JvdXApKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgR3JvdXBcclxuICAgICAgICAgICAgZ3JvdXAgPSAodHlwZW9mKGdyb3VwKSA9PSBcInN0cmluZ1wiKT8gZ3JvdXA6IFwiI1wiO1xyXG4gICAgICAgICAgICBpZihncm91cCAhPT0gXCIjXCIgJiYgIShncm91cCBpbiB0aGlzLmdyb3Vwcykpe1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGdyb3VwID0gY3JlYXRlKFwiT1BUR1JPVVBcIik7XHJcbiAgICAgICAgICAgICAgICBvcHRncm91cC5sYWJlbCA9IGdyb3VwO1xyXG4gICAgICAgICAgICAgICAgb3B0Z3JvdXAuc2V0QXR0cmlidXRlKFwiZGF0YS1zZWxlY3Qtb3B0Z3JvdXBcIiwgXCJhZGRcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQob3B0Z3JvdXApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc1tncm91cF0gPSB7fTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IG9wdGdyb3VwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSBTZWxlY3Rpb25cclxuICAgICAgICAgICAgaWYodGhpcy5zZWxmLmNvbi5tdWx0aXBsZSAmJiB0aGlzLnNlbGVjdGVkLmxlbmd0aCA+PSB0aGlzLnNlbGYuY29uLm11bHRpTGltaXQpe1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkaXNhYmxlZCA9ICEhZGlzYWJsZWQ7XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgT3B0aW9uXHJcbiAgICAgICAgICAgIHZhciBvcHRpb24gPSBkLmNyZWF0ZUVsZW1lbnQoXCJPUFRJT05cIik7XHJcbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGtleTtcclxuICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgIG9wdGlvbi5kaXNhYmxlZCA9IGRpc2FibGVkO1xyXG4gICAgICAgICAgICBvcHRpb24uaW5uZXJUZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbGVjdC1vcHRpb25cIiwgXCJhZGRcIik7XHJcbiAgICAgICAgICAgIGlmKGRlc2NyaXB0aW9uICYmIGRlc2NyaXB0aW9uLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgb3B0aW9uLnNldEF0dHJpYnV0ZShcImRhdGEtZGVzY3JpcHRpb25cIiwgZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgT3B0aW9uIGFuZCBSZXR1cm5cclxuICAgICAgICAgICAgKChncm91cCA9PSBcIiNcIik/IHRoaXMuZWxlbWVudDogdGhpcy5ncm91cHNbZ3JvdXBdKS5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXQob3B0aW9uLCByZWJ1aWxkKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBNT1ZFIEFOIEVYSVNUSU5HIE9QVElPTlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4wIFswLjUuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBtb3ZlOiBmdW5jdGlvbihpdGVtLCBncm91cCwgbmV3X2dyb3VwLCByZWJ1aWxkKXtcclxuICAgICAgICAgICAgaWYoIShpdGVtID0gdGhpcy5nZXQoaXRlbSwgZ3JvdXApKSl7IHJldHVybiBmYWxzZTsgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIEdyb3VwXHJcbiAgICAgICAgICAgIGlmKG5ld19ncm91cCAhPT0gXCIjXCIgJiYgIShuZXdfZ3JvdXAgaW4gdGhpcy5ncm91cHMpKXtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRncm91cCA9IGNyZWF0ZShcIk9QVEdST1VQXCIpO1xyXG4gICAgICAgICAgICAgICAgb3B0Z3JvdXAubGFiZWwgPSBuZXdfZ3JvdXA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQob3B0Z3JvdXApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc1tuZXdfZ3JvdXBdID0ge307XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tuZXdfZ3JvdXBdID0gb3B0Z3JvdXA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tuZXdfZ3JvdXBdLmFwcGVuZENoaWxkKGl0ZW0ub3B0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTW92ZSBUbyBHcm91cFxyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5pdGVtc1tpdGVtLmdyb3VwXVtpdGVtLmtleV07XHJcbiAgICAgICAgICAgIGl0ZW0uZ3JvdXAgPSBuZXdfZ3JvdXA7XHJcbiAgICAgICAgICAgIGl0ZW0ub3B0Z3JvdXAgPSB0aGlzLmdyb3Vwc1tuZXdfZ3JvdXBdIHx8IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5pdGVtc1tuZXdfZ3JvdXBdW2l0ZW0ua2V5XSA9IGl0ZW07XHJcbiAgICAgICAgICAgIHJldHVybiAocmVidWlsZCk/IHRoaXMuc2VsZi5xdWVyeSgpOiB0cnVlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIFJFTU9WRSBBTiBFWElTVElORyBPUFRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuNyBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihpdGVtLCBncm91cCwgcmVidWlsZCl7XHJcbiAgICAgICAgICAgIGlmKCEoaXRlbSA9IHRoaXMuZ2V0KGl0ZW0sIGdyb3VwKSkpeyByZXR1cm4gZmFsc2U7IH1cclxuICAgICAgICAgICAgaWYoaXRlbS5zZWxlY3RlZCl7IHRoaXMudW5zZWxlY3QoaXRlbSk7IH1cclxuICAgICAgICAgICAgaWYoaXRlbS5kaXNhYmxlZCl7IHRoaXMuZW5hYmxlKGl0ZW0pOyB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZW1vdmUgRGF0YVxyXG4gICAgICAgICAgICBpdGVtLm9wdGlvbi5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGl0ZW0ub3B0aW9uKTtcclxuICAgICAgICAgICAgdmFyIGlkID0gKC9eWzAtOV0rJC8udGVzdChpdGVtLmtleSkpPyBcIl9cIiArIGl0ZW0ua2V5OiBpdGVtLmtleTtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuaXRlbXNbaXRlbS5ncm91cF1baWRdO1xyXG4gICAgICAgICAgICB0aGlzLmxlbmd0aC0tO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIE9wdGdyb3VwXHJcbiAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuaXRlbXNbaXRlbS5ncm91cF0pLmxlbmd0aCA9PT0gMCl7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5pdGVtc1tpdGVtLmdyb3VwXTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tpdGVtLmdyb3VwXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKHJlYnVpbGQpPyB0aGlzLnNlbGYucXVlcnkoKTogdHJ1ZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBDSEVDSyBBTiBFWElTVElORyBPUFRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaXM6IGZ1bmN0aW9uKHN0YXRlLCBrZXksIGdyb3VwKXtcclxuICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcihzdGF0ZSksIGl0ZW0gPSB0aGlzLmdldChrZXksIGdyb3VwKTtcclxuICAgICAgICAgICAgaWYoIWl0ZW0gfHwgW1wic2VsZWN0XCIsIFwidW5zZWxlY3RcIiwgXCJkaXNhYmxlXCIsIFwiZW5hYmxlXCJdLmluZGV4T2Yoc3RhdGUpIDwgMCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihzdGF0ZSA9PSBcImRpc2FibGVcIiB8fCBzdGF0ZSA9PSBcImVuYWJsZVwiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoc3RhdGUgPT0gXCJkaXNhYmxlXCIpPyBpdGVtLmRpc2FibGVkOiAhaXRlbS5kaXNhYmxlZDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHN0YXRlID09IFwic2VsZWN0XCIgfHwgc3RhdGUgPT0gXCJ1bnNlbGVjdFwiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoc3RhdGUgPT0gXCJzZWxlY3RcIik/IGl0ZW0uc2VsZWN0ZWQ6ICFpdGVtLnNlbGVjdGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBJTlRFUkFDVCBXSVRIIEFOIE9QVElPTlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4zIFswLjMuMF1cclxuICAgICAgICAgKi9cclxuICAgICAgICBoYW5kbGU6IGZ1bmN0aW9uKHN0YXRlLCBrZXksIGdyb3VwLCBfZm9yY2Upe1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuZ2V0KGtleSwgZ3JvdXApLCBzdGF0ZSA9IHRoaXMuX3Ioc3RhdGUpO1xyXG4gICAgICAgICAgICBpZighaXRlbSB8fCBbXCJzZWxlY3RcIiwgXCJ1bnNlbGVjdFwiLCBcImRpc2FibGVcIiwgXCJlbmFibGVcIl0uaW5kZXhPZihzdGF0ZSkgPCAwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBEaXNhYmxlIHx8IEVuYWJsZVxyXG4gICAgICAgICAgICBpZihzdGF0ZSA9PSBcImRpc2FibGVcIiB8fCBzdGF0ZSA9PSBcImVuYWJsZVwiKXtcclxuICAgICAgICAgICAgICAgIGlmKCEoaXRlbS5vcHRpb24gaW4gdGhpcy5kaXNhYmxlZCkgJiYgc3RhdGUgPT0gXCJkaXNhYmxlXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQucHVzaChpdGVtLm9wdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoKGl0ZW0ub3B0aW9uIGluIHRoaXMuZGlzYWJsZWQpICYmIHN0YXRlID09IFwiZW5hYmxlXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQuc3BsaWNlKHRoaXMuZGlzYWJsZWQuaW5kZXhPZihpdGVtLm9wdGlvbiksIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9IChzdGF0ZSA9PSBcImRpc2FibGVcIik7XHJcbiAgICAgICAgICAgICAgICBpdGVtLm9wdGlvbi5kaXNhYmxlZCA9IChzdGF0ZSA9PSBcImRpc2FibGVcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxmLmNhbGxiYWNrLmNhbGwodGhpcy5zZWxmLCBpdGVtLCBzdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNlbGVjdCB8fCBVbnNlbGVjdFxyXG4gICAgICAgICAgICB2YXIgZGlzID0gKGNIQVModGhpcy5zZWxmLnNlbGVjdCwgXCJkaXNhYmxlZFwiKSB8fCBpdGVtLmRpc2FibGVkIHx8IGl0ZW0ub3B0aW9uLmRpc2FibGVkKSxcclxuICAgICAgICAgICAgICAgIGxtdCA9ICh0aGlzLnNlbGYuY29uLm11bHRpcGxlICYmIHRoaXMuc2VsZi5jb24ubXVsdGlMaW1pdCA8PSB0aGlzLnNlbGVjdGVkLmxlbmd0aCksXHJcbiAgICAgICAgICAgICAgICBzZ2wgPSAoIXRoaXMuc2VsZi5jb24ubXVsdGlwbGUgJiYgdGhpcy5zZWxlY3RlZC5pbmRleE9mKGl0ZW0ub3B0aW9uKSA+IDApLFxyXG4gICAgICAgICAgICAgICAgZGVsID0gKHRoaXMuc2VsZi5jb24ubXVsdGlMaW1pdCA9PSAwICYmIHRoaXMuc2VsZi5jb24uZGVzZWxlY3QgPT0gdHJ1ZSksXHJcbiAgICAgICAgICAgICAgICB1bnMgPSAoIXRoaXMuc2VsZi5jb24ubXVsdGlwbGUgJiYgIXRoaXMuc2VsZi5jb24uZGVzZWxlY3QgJiYgX2ZvcmNlICE9PSB0cnVlKTtcclxuICAgICAgICAgICAgaWYoc3RhdGUgPT0gXCJzZWxlY3RcIil7XHJcbiAgICAgICAgICAgICAgICBpZihkaXMgfHwgbG10IHx8IGRlbCB8fCBzZ2wpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNlbGYuY29uLm11bHRpcGxlKXtcclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5zZWxlY3RlZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZWxlY3QodGhpcy5zZWxlY3RlZFtpXSwgdW5kZWZpbmVkLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkLmluZGV4T2YoaXRlbS5vcHRpb24pIDwgMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5wdXNoKGl0ZW0ub3B0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmKHN0YXRlID09IFwidW5zZWxlY3RcIil7XHJcbiAgICAgICAgICAgICAgICBpZihkaXMgfHwgdW5zKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLnNwbGljZSh0aGlzLnNlbGVjdGVkLmluZGV4T2YoaXRlbS5vcHRpb24pLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gKHN0YXRlID09IFwic2VsZWN0XCIpO1xyXG4gICAgICAgICAgICBpdGVtLm9wdGlvbi5zZWxlY3RlZCA9IChzdGF0ZSA9PSBcInNlbGVjdFwiKTtcclxuICAgICAgICAgICAgaXRlbS5vcHRpb25bKHN0YXRlLmxlbmd0aCA+IDY/IFwicmVtb3ZlXCI6IFwic2V0XCIpICsgXCJBdHRyaWJ1dGVcIl0oXCJzZWxlY3RlZFwiLCBcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxmLmNhbGxiYWNrLmNhbGwodGhpcy5zZWxmLCBpdGVtLCBzdGF0ZSwgX2ZvcmNlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oa2V5LCBncm91cCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZShcImVuYWJsZVwiLCBrZXksIGdyb3VwLCBmYWxzZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbihrZXksIGdyb3VwKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlKFwiZGlzYWJsZVwiLCBrZXksIGdyb3VwLCBmYWxzZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKGtleSwgZ3JvdXApe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGUoXCJzZWxlY3RcIiwga2V5LCBncm91cCwgZmFsc2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdW5zZWxlY3Q6IGZ1bmN0aW9uKGtleSwgZ3JvdXAsIF9mb3JjZSl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZShcInVuc2VsZWN0XCIsIGtleSwgZ3JvdXAsIF9mb3JjZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGl0ZW0sIGdyb3VwKXtcclxuICAgICAgICAgICAgaWYoIShpdGVtID0gdGhpcy5nZXQoaXRlbSwgZ3JvdXApKSl7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGUoKGl0ZW0uc2VsZWN0ZWQ/IFwidW5zZWxlY3RcIjogXCJzZWxlY3RcIiksIGl0ZW0sIGdyb3VwLCBmYWxzZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgSU5WRVJUIENVUlJFTlQgPFNUQVRFPlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4xNSBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaW52ZXJ0OiBmdW5jdGlvbihzdGF0ZSl7XHJcbiAgICAgICAgICAgIHN0YXRlID0gdGhpcy5fcihzdGF0ZSk7XHJcbiAgICAgICAgICAgIGlmKFtcImVuYWJsZVwiLCBcImRpc2FibGVcIl0uaW5kZXhPZihzdGF0ZSkgPj0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW52ZXJ0ID0gdGhpcy5kaXNhYmxlZCwgYWN0aW9uID0gKHN0YXRlID09IFwiZW5hYmxlXCIpPyBcImRpc2FibGVcIjogXCJlbmFibGVcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKFtcInNlbGVjdFwiLCBcInVuc2VsZWN0XCJdLmluZGV4T2Yoc3RhdGUpID49IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIGludmVydCA9IHRoaXMuc2VsZWN0ZWQsIGFjdGlvbiA9IChzdGF0ZSA9PSBcInNlbGVjdFwiKT8gXCJ1bnNlbGVjdFwiOiBcInNlbGVjdFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjb252ZXJ0ID0gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKHRoaXMsIGZ1bmN0aW9uKGVsZW1lbnQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICEoZWxlbWVudCBpbiBpbnZlcnQpO1xyXG4gICAgICAgICAgICB9KSwgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICAvLyBMb29wXHJcbiAgICAgICAgICAgIFtdLmNvbmNhdChpbnZlcnQpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZS5jYWxsKHNlbGYsIGFjdGlvbiwgaXRlbSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBbXS5jb25jYXQoY29udmVydCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlLmNhbGwoc2VsZiwgc3RhdGUsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgU0VUIDxTVEFURT4gT04gQUxMIE9QVElPTnNcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMCBbMC41LjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgYWxsOiBmdW5jdGlvbihzdGF0ZSwgZ3JvdXApe1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGxpc3QgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZihncm91cCBpbiB0aGlzLml0ZW1zKXtcclxuICAgICAgICAgICAgICAgIGxpc3QgPSBPYmplY3Qua2V5cyh0aGlzLml0ZW1zW2dyb3VwXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihbXCJ1bnNlbGVjdFwiLCBcImVuYWJsZVwiXS5pbmRleE9mKHN0YXRlKSA+PSAwKXtcclxuICAgICAgICAgICAgICAgIGxpc3QgPSBbXS5jb25jYXQoKHN0YXRlID09IFwidW5zZWxlY3RcIik/IHRoaXMuc2VsZWN0ZWQ6IHRoaXMuZGlzYWJsZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobGlzdCwgZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZS5jYWxsKHNlbGYsIHN0YXRlLCBpdGVtLCBncm91cCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAgfCAgU0VUIDxTVEFURT4gRk9SIEEgQlVOQ0ggT0YgT1BUSU9Oc1xyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS40IFswLjUuM11cclxuICAgICAgICAgKi9cclxuICAgICAgICB3YWxrOiBmdW5jdGlvbihzdGF0ZSwgaXRlbXMsIGFyZ3Mpe1xyXG4gICAgICAgICAgICBpZihpdGVtcyBpbnN0YW5jZW9mIEFycmF5IHx8IGl0ZW1zLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGwgPSBpdGVtcy5sZW5ndGgsIGkgPSAwOyBpIDwgbDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZS5hcHBseSh0aGlzLCBbc3RhdGUsIGl0ZW1zW2ldLCBudWxsXS5jb25jYXQoYXJncykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYoaXRlbXMgaW5zdGFuY2VvZiBPYmplY3Qpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgaWYoaXRlbXMuZm9yRWFjaCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlLmFwcGx5KHNlbGYsIFtzdGF0ZSwgdmFsdWUsIG51bGxdLmNvbmNhdChhcmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGl0ZW1zKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGl0ZW1zW2tleV0pICE9IFwic3RyaW5nXCIgJiYgdHlwZW9mKGl0ZW1zW2tleV0pICE9IFwibnVtYmVyXCIgJiYgIShpdGVtc1trZXldIGluc3RhbmNlb2YgRWxlbWVudCkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGUuYXBwbHkodGhpcywgW3N0YXRlLCBpdGVtc1trZXldLCAoa2V5IGluIHRoaXMuaXRlbXM/IGtleTogbnVsbCldKS5jb25jYXQoYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIEFQUExZIExJTkdVU1RJQyBSVUxFU1xyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4xMyBbMC41LjEzXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGFwcGx5TGluZ3Vpc3RpY1J1bGVzOiBmdW5jdGlvbihzZWFyY2gsIGNhc2VzZW5zaXRpdmUpe1xyXG4gICAgICAgICAgICB2YXIgcnVsZXMgPSB0aGlzLnNlbGYuY29uLmxpbmd1aXN0aWNSdWxlcywgdmFsdWVzID0gW107XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBQcmVwYXJlIFJ1bGVzXHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJ1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSl7IFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goXCIoXCIgKyBrZXkgKyBcInxbXCIgKyBydWxlc1trZXldICsgXCJdKVwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmKGNhc2VzZW5zaXRpdmUpe1xyXG4gICAgICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzLmNvbmNhdCh2YWx1ZXMubWFwKGZ1bmN0aW9uKHMpeyByZXR1cm4gcy50b1VwcGVyQ2FzZSgpOyB9KSk7IFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoLnJlcGxhY2UobmV3IFJlZ0V4cCh2YWx1ZXMuam9pbihcInxcIiksIChjYXNlc2Vuc2l0aXZlKT8gXCJnXCI6IFwiaWdcIiksIGZ1bmN0aW9uKG0pe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1tbXS5pbmRleE9mLmNhbGwoYXJndW1lbnRzLCBtLCAxKSAtIDFdO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIEZJTkQgU09NRSBPUFRJT05zIC0gQVJSQVkgRURJVElPTlxyXG4gICAgICAgICB8ICBAc2luY2UgIDAuNS4xNSBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZmluZDogZnVuY3Rpb24oc2VhcmNoLCBjb25maWcpe1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIG1hdGNoZXMsIGhhcyA9IHt9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gR2V0IENvbmZpZ1xyXG4gICAgICAgICAgICBpZighY29uZmlnKXtcclxuICAgICAgICAgICAgICAgIGNvbmZpZyA9IHRoaXMuc2VsZi5jb24uc2VhcmNoQ29uZmlnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb25maWcgQ2FsbGJhY2tcclxuICAgICAgICAgICAgaWYodHlwZW9mIGNvbmZpZyA9PT0gXCJmdW5jdGlvblwiKXtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBjb25maWcuYmluZCh0aGlzLCBzZWFyY2gpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb25maWcgSGFuZGxlclxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZyA9IChjb25maWcgaW5zdGFuY2VvZiBBcnJheSk/IGNvbmZpZzogW2NvbmZpZ107XHJcbiAgICAgICAgICAgICAgICBjb25maWcuZm9yRWFjaChmdW5jdGlvbihjKXtcclxuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoYykgPT09IFwic3RyaW5nXCIpeyBoYXNbY10gPSB0cnVlOyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGhhcy5hbnkgPSAoIWhhcy5hbnkpPyBoYXMuYXR0cmlidXRlcyAmJiBoYXMudmFsdWU6IGhhcy5hbnk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENsZWFudXAgJiBQcmVwYXJlXHJcbiAgICAgICAgICAgICAgICBpZighaGFzLnJlZ2V4IHx8IGhhcy50ZXh0KXtcclxuICAgICAgICAgICAgICAgICAgICBzZWFyY2ggPSBzZWFyY2gucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoIWhhcy5leGFjdGdseXBoZXMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaCA9IHRoaXMuc2VsZi5vcHRpb25zLmFwcGx5TGluZ3Vpc3RpY1J1bGVzKHNlYXJjaCwgaGFzLmNhc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoaGFzLndvcmQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaCA9ICdcXFxcYicgKyBzZWFyY2ggKyAnXFxcXGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFNlYXJjaFxyXG4gICAgICAgICAgICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChzZWFyY2gsICghaGFzLmNhc2UpPyBcIm1pXCI6IFwibVwiKSxcclxuICAgICAgICAgICAgICAgICAgICBzZnVuYyA9IGZ1bmN0aW9uKG9wdCl7IHJldHVybiByZWdleC50ZXN0KG9wdC50ZXh0IHx8IG9wdC52YWx1ZSk7IH07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZVxyXG4gICAgICAgICAgICAgICAgaWYoaGFzLmFueSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IGZ1bmN0aW9uKG9wdCl7IHJldHVybiBzZnVuYyhvcHQpIHx8IFtdLnNvbWUuY2FsbChvcHQuYXR0cmlidXRlcywgc2Z1bmMpOyB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKGhhcy5hdHRyaWJ1dGVzKXtcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gZnVuY3Rpb24ob3B0KXsgcmV0dXJuIFtdLnNvbWUuY2FsbChvcHQuYXR0cmlidXRlcywgc2Z1bmMpOyB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gc2Z1bmM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2VsZi5jb24uc2VhcmNoRGlzYWJsZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gbWF0Y2hlcztcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gZnVuY3Rpb24ob3B0KXsgcmV0dXJuICFvcHQuZGlzYWJsZWQgJiYgdGVtcChvcHQpOyB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBIYW1tZXIgVGltZVxyXG4gICAgICAgICAgICByZXR1cm4gW10uZmlsdGVyLmNhbGwodGhpcy5zZWxmLmUub3B0aW9ucywgbWF0Y2hlcykubWFwKGZ1bmN0aW9uKG9wdCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0LmhpZGRlbj8gZmFsc2U6IHNlbGYuZ2V0KG9wdCkgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIHwgIEZJTkQgU09NRSBPUFRJT05zIC0gV0FMS0VSIEVESVRJT05cclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuNSBbMC4zLjBdXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZmluZGVyOiBmdW5jdGlvbihzZWFyY2gsIGNvbmZpZyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuX2ZpbmRlckxvb3AgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9maW5kZXJMb29wID0gdGhpcy5maW5kKHNlYXJjaCwgY29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgaXRlbTtcclxuICAgICAgICAgICAgd2hpbGUoKGl0ZW0gPSB0aGlzLl9maW5kZXJMb29wLnNoaWZ0KCkpICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2ZpbmRlckxvb3A7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICB8ICBORVcgT1BUSU9OUyBXQUxLRVJcclxuICAgICAgICAgfCAgQHNpbmNlICAwLjUuMTUgWzAuNC4wXVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHdhbGtlcjogZnVuY3Rpb24ob3JkZXJpLCBvcmRlcmcpe1xyXG4gICAgICAgICAgICBpZih0eXBlb2YodGhpcy5faW5Mb29wKSAhPSBcInVuZGVmaW5lZFwiICYmIHRoaXMuX2luTG9vcCl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9pbkl0ZW1zLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLml0ZW1zW3RoaXMuX2luR3JvdXBdW3RoaXMuX2luSXRlbXMuc2hpZnQoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSh0ZW1wLmhpZGRlbiA9PT0gdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU29ydCBJdGVtc1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5faW5Hcm91cHMubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUodGhpcy5faW5Hcm91cHMubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncm91cCA9IHRoaXMuX2luR3JvdXBzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEoZ3JvdXAgaW4gdGhpcy5pdGVtcykpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuaXRlbXNbZ3JvdXBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5cy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKG9yZGVyaSA9PSBcIkFTQ1wiKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5cy5zb3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKG9yZGVyaSA9PSBcIkRFU0NcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXMuc29ydCgpLnJldmVyc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYodHlwZW9mKG9yZGVyaSkgPT0gXCJmdW5jdGlvblwiKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5cyA9IG9yZGVyaS5jYWxsKHRoaXMsIGtleXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbkl0ZW1zID0ga2V5cztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbkdyb3VwID0gZ3JvdXA7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2Fsa2VyKG51bGwsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBhbmQgRXhpdFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2luTG9vcDtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9pbkl0ZW1zO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2luR3JvdXA7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5faW5Hcm91cHM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNvcnQgR3JvdXBzXHJcbiAgICAgICAgICAgIHZhciBncm91cHMgPSBPYmplY3Qua2V5cyh0aGlzLmdyb3VwcykgfHwgW107XHJcbiAgICAgICAgICAgIGlmKG9yZGVyZyA9PSBcIkFTQ1wiKXtcclxuICAgICAgICAgICAgICAgIGdyb3Vwcy5zb3J0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihvcmRlcmcgPT0gXCJERVNDXCIpe1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBzLnNvcnQoKS5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlb2Yob3JkZXJnKSA9PSBcImZ1bmN0aW9uXCIpe1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBzID0gb3JkZXJnLmNhbGwodGhpcywgZ3JvdXBzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncm91cHMudW5zaGlmdChcIiNcIik7XHJcblxyXG4gICAgICAgICAgICAvLyBJbml0IExvb3BcclxuICAgICAgICAgICAgdGhpcy5faW5Mb29wID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5faW5JdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9pbkdyb3VwcyA9IGdyb3VwcztcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2Fsa2VyKG9yZGVyaSwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBSZXR1cm5cclxuICAgIHJldHVybiBzZWxlY3Q7XHJcbn0pKTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/tail.select/js/tail.select.js\n");

/***/ }),

/***/ 1:
/*!**********************************************************!*\
  !*** multi ./node_modules/tail.select/js/tail.select.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! D:\Escritorio\Andres\Laravel\proyecto_final\node_modules\tail.select\js\tail.select.js */"./node_modules/tail.select/js/tail.select.js");


/***/ })

/******/ });